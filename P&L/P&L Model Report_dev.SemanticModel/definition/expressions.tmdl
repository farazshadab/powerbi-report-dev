expression Dim_Product_Code = ```
		/*
		let
		    Source = Value.NativeQuery(Snowflake.Databases("danone.west-europe.azure.snowflakecomputing.com","PRD_SNS_UKI_ANL_WH",[Role="PRD_SNS_UKI_USER", Implementation="2.0"]){[Name="PRD_SNS_UKI"]}[Data], "select PRODUCT_ID,PRODUCT_CODE from PRD_SNS_UKI.SNS_UKI_DSP_SNU.DIM_PRODUCT", null, [EnableFolding=true])
		in
		    
		*/
		let x = "" in x
		```
	lineageTag: a2478ca9-1ea6-462a-891f-657efb1e6a56
	queryGroup: Archive

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Text

expression MDS_CPD =
		let
		    Source = Value.NativeQuery(Snowflake.Databases("danone.west-europe.azure.snowflakecomputing.com","PRD_UKI_ANL_WH",[Implementation="2.0", Role="PRD_UKI_USER"]){[Name="PRD_UKI"]}[Data], "SELECT * FROM PRD_UKI.UKI_DSP_SNU.CONTRACT_PNL_CPD", null, [EnableFolding=true]),
		    #"Renamed Columns" = Table.RenameColumns(Source,{{"ACCURED", "ANNUAL_VALUE"}}),
		    #"Added Custom" = Table.AddColumn(#"Renamed Columns", "Spons_Source", each "MDS_CDP")
		in
		    #"Added Custom"
	lineageTag: 18708156-f474-4ecc-ba21-a29e2035302e

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Exception

expression DIM_Contract_details =
		let x="" in x
		
		/*let
		    Source = Value.NativeQuery(Snowflake.Databases("danone.west-europe.azure.snowflakecomputing.com","PRD_SNS_UKI_ANL_WH",[Role="PRD_SNS_UKI_USER", Implementation="2.0"]){[Name="PRD_SNS_UKI"]}[Data], "with cte as(#(lf)select   src_id, CURO_SUB_CONTRACT_ID,   SUB_CONTRACT_NAME  FROM PRD_SNS_UKI.SNS_UKI_DSP_SNU.DIM_CURO_SUB_CONTRACT#(lf)    where SRC_ID not in #(lf)(#(lf)'a4a2400000002ahAAA',#(lf)'a4a2400000002amAAA',#(lf)'a4a240000008oxLAAQ',#(lf)'a4a240000008oxQAAQ',#(lf)'a4a4L000000QFngQAG',#(lf)'a4a2400000002b7AAA',#(lf)'a4a2400000002b9AAA',#(lf)'a4a1p000000GtsvAAC',#(lf)'a4a2400000002bBAAQ',#(lf)'a4a2400000002bGAAQ',#(lf)'a4a2400000002bKAAQ',#(lf)'a4a240000008oxaAAA',#(lf)'a4a2400000002bSAAQ',#(lf)'a4a4J000000yDBqQAM',#(lf)'a4a4J000000yDBCQA2',#(lf)'a4a2400000002bWAAQ',#(lf)'a4a4J000000yDBHQA2',#(lf)'a4a2400000002bbAAA',#(lf)'a4a4J000000yD7eQAE',#(lf)'a4a2400000002bdAAA',#(lf)'a4a2400000002bfAAA',#(lf)'a4a4J000000yDC0QAM',#(lf)'a4a2400000002bnAAA',#(lf)'a4a2400000002bpAAA',#(lf)'a4a4J000000yDBbQAM',#(lf)'a4a240000008QXdAAM',#(lf)'a4a2400000002bsAAA',#(lf)'a4a2400000002buAAA',#(lf)'a4a2400000002dnAAA',#(lf)'a4a2400000002doAAA',#(lf)'a4a2400000002bwAAA',#(lf)'a4a4J000000yD8cQAE',#(lf)'a4a4J000000yDBSQA2',#(lf)'a4a2400000002byAAA',#(lf)'a4a2400000002b2AAA',#(lf)'a4a240000008QVrAAM',#(lf)'a4a2400000002c0AAA',#(lf)'a4a4L000000KjepQAC',#(lf)'a4a4J000000yD9VQAU',#(lf)'a4a4J000000yDB2QAM',#(lf)'a4a4L000000EYICQA4',#(lf)'a4a2400000002c2AAA',#(lf)'a4a2400000002c8AAA',#(lf)'a4a4J000000yDBDQA2',#(lf)'a4a4J000000yDBMQA2',#(lf)'a4a4J000000yDBlQAM',#(lf)'a4a2400000002cBAAQ',#(lf)'a4a2400000002cDAAQ',#(lf)'a4a240000008oxBAAQ',#(lf)'a4a240000008QL8AAM',#(lf)'a4a240000008ox6AAA',#(lf)'a4a240000008QL3AAM',#(lf)'a4a240000008oxGAAQ',#(lf)'a4a240000008QKeAAM',#(lf)'a4a240000008QKZAA2',#(lf)'a4a2400000002djAAA',#(lf)'a4a240000008QKoAAM',#(lf)'a4a240000008QKjAAM',#(lf)'a4a240000008oxkAAA',#(lf)'a4a4J000000yD8SQAU',#(lf)'a4a4J000000yD7jQAE',#(lf)'a4a4J000000yDATQA2',#(lf)'a4a4J000000yDA9QAM',#(lf)'a4a1p0000008oynAAA',#(lf)'a4a2400000002caAAA',#(lf)'a4a2400000002ccAAA',#(lf)'a4a2400000002ceAAA',#(lf)'a4a2400000002l7AAA',#(lf)'a4a4L000000EYmqQAG',#(lf)'a4a2400000002cgAAA',#(lf)'a4a2400000002ciAAA',#(lf)'a4a2400000002cuAAA',#(lf)'a4a2400000002czAAA',#(lf)'a4a4J000000yD8NQAU',#(lf)'a4a4J000000yDBRQA2',#(lf)'a4a4J000000yDBWQA2',#(lf)'a4a4J000000yDBvQAM',#(lf)'a4a4J000000yDAnQAM',#(lf)'a4a2400000002dDAAQ',#(lf)'a4a4J000000yD8XQAU'#(lf)#(lf)  )) #(lf)#(lf)select CURO_SUB_CONTRACT_ID,   SUB_CONTRACT_NAME  from cte where#(lf)src_id not in('a4a240000008oxaAAA','a4a240000008oxBAAQ') --NHS BORDERS and CALDERDALE & HUDDERSFIELD NHSFT", null, [EnableFolding=true]),
		    #"Merged Queries" = Table.NestedJoin(Source, {"CURO_SUB_CONTRACT_ID"}, DIM_MEDICAL_CONTRACT, {"CURO_SUB_CONTRACT_ID"}, "DIM_MEDICAL_CONTRACT", JoinKind.LeftOuter),
		    #"Expanded DIM_MEDICAL_CONTRACT" = Table.ExpandTableColumn(#"Merged Queries", "DIM_MEDICAL_CONTRACT", {"CONTRACT_ID", "CONTRACT_R_ID", "CURO_SUB_CONTRACT_ID", "CONTRACT_CODE", "Medical Contract", "Current Contract"}, {"CONTRACT_ID", "CONTRACT_R_ID", "CURO_SUB_CONTRACT_ID.1", "CONTRACT_CODE", "Medical Contract", "Current Contract"}),
		    #"Merged Queries1" = Table.NestedJoin(#"Expanded DIM_MEDICAL_CONTRACT", {"CONTRACT_R_ID"}, DIM_MEDICAL_CONTRACT_R, {"CONTRACT_R_ID"}, "DIM_MEDICAL_CONTRACT_R", JoinKind.LeftOuter),
		    #"Expanded DIM_MEDICAL_CONTRACT_R" = Table.ExpandTableColumn(#"Merged Queries1", "DIM_MEDICAL_CONTRACT_R", {"CONTRACT_R_ID", "CONTRACT_R_NAME", "MDS_CODE", "CONTRACT_R_CODE", "CONTRACT_TYPE", "CONTRACT_STATUS", "CONTRACT_HOLDER", "CONTRACT_START_STATUS", "CONTRACT_START_DATE", "CONTRACT_END_DATE", "DATE_WIN_REWIN_EXTENSION", "ROLLOVER_OPTION", "CURRENT_NURSE_FTE", "CURRENT_TPA_PRICING", "FORECAST_TENDER_DATE", "FORECAST_CONTRACT_START_DATE", "FUTURE_CONTRACT_NURSE_FTE", "FUTURE_CONTRACTED_FUNDING", "TARGETING_STATUS", "WIN_PROBABILITY", "CURRENT_PATIENT_NUMBERS", "FUTURE_CONTRACT_TPA_PRICING", "FUTURE_CONTRACT_PUMP_NUMBERS", "FUTURE_COM_LINK_AND_GROWTH", "COMMENTARY", "DWH_CREATEDT", "DWH_LUPDT", "ALT_CONTRACT_ACC_HOLDER"}, {"CONTRACT_R_ID.1", "CONTRACT_R_NAME", "MDS_CODE", "CONTRACT_R_CODE", "CONTRACT_TYPE", "CONTRACT_STATUS", "CONTRACT_HOLDER", "CONTRACT_START_STATUS", "CONTRACT_START_DATE", "CONTRACT_END_DATE", "DATE_WIN_REWIN_EXTENSION", "ROLLOVER_OPTION", "CURRENT_NURSE_FTE", "CURRENT_TPA_PRICING", "FORECAST_TENDER_DATE", "FORECAST_CONTRACT_START_DATE", "FUTURE_CONTRACT_NURSE_FTE", "FUTURE_CONTRACTED_FUNDING", "TARGETING_STATUS", "WIN_PROBABILITY", "CURRENT_PATIENT_NUMBERS", "FUTURE_CONTRACT_TPA_PRICING", "FUTURE_CONTRACT_PUMP_NUMBERS", "FUTURE_COM_LINK_AND_GROWTH", "COMMENTARY", "DWH_CREATEDT", "DWH_LUPDT", "ALT_CONTRACT_ACC_HOLDER"})
		in
		    #"Expanded DIM_MEDICAL_CONTRACT_R"*/
	lineageTag: f5274e82-2c2d-4fc6-a93c-8a1d6238beee
	queryGroup: Archive

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Text

expression 'P&L_Query (og)' = ```
		/*let
		    Source = Value.NativeQuery(Snowflake.Databases("danone.west-europe.azure.snowflakecomputing.com","PRD_SNS_UKI_ANL_WH",[Role="PRD_SNS_UKI_USER", Implementation="2.0"]){[Name="PRD_SNS_UKI"]}[Data], 
		    "
		SELECT
		SOURCE,
		CONTRACT_ID,
		CONTRACT_R_ID,
		CURO_SUB_CONTRACT_ID,
		SALES_CHANNEL_ID,
		PRODUCT_ID,
		GEOGRAPHY_ID,
		PUMP_DATE,
		MEASURE_NAME,
		MEASURE_VALUE
		FROM (
		
		With MAX_MTH AS
		(
		    SELECT
		TO_NUMBER(TO_VARCHAR(LAST_DAY(TO_DATE(MAX('202503')|| '01','YYYYMMDD')),'YYYYMMDD')) AS STARTDATE,
		TO_NUMBER(TO_VARCHAR(ADD_MONTHS(TO_DATE(MAX('202503')|| '01','YYYYMMDD'),-11),'YYYYMMDD')) AS ENDDATE,
		LAST_DAY(TO_DATE(MAX('202503')|| '01','YYYYMMDD'))::TIMESTAMP_TZ AS MONTHEND_TZ,
		DATEADD(DAY,-1,LAST_DAY(TO_DATE(MAX('202503')|| '01','YYYYMMDD')))::TIMESTAMP_TZ AS MONTHEND_TZ1,
		TO_DATE(MAX('202503')|| '01','YYYYMMDD')::TIMESTAMP_TZ AS MONTHSTART_TZ
		
		// SELECT 
		// TO_NUMBER(TO_VARCHAR(LAST_DAY(TO_DATE(MAX(MONTH_ID)|| '01','YYYYMMDD')),'YYYYMMDD')) AS STARTDATE,
		// TO_NUMBER(TO_VARCHAR(ADD_MONTHS(TO_DATE(MAX(MONTH_ID)|| '01','YYYYMMDD'),-11),'YYYYMMDD')) AS ENDDATE,
		// LAST_DAY(TO_DATE(MAX(MONTH_ID)|| '01','YYYYMMDD'))::TIMESTAMP_TZ AS MONTHEND_TZ,
		// DATEADD(DAY,-1,LAST_DAY(TO_DATE(MAX(MONTH_ID)|| '01','YYYYMMDD')))::TIMESTAMP_TZ AS MONTHEND_TZ1,
		// TO_DATE(MAX(MONTH_ID)|| '01','YYYYMMDD')::TIMESTAMP_TZ AS MONTHSTART_TZ
		// FROM SNS_UKI_DSP_SNU.FACT_IQVIA_RSA
		
		    )
		,DIM_CURO_ACTIVE_PATIENT AS (
		SELECT 
		    CASE WHEN TO_CHAR(DWH_START_DATE,'YYYYMMDD')='19010101' THEN  PMS_START_DATE ELSE  DWH_START_DATE END AS DWH_START_DATE,
		    DWH_END_DATE,
		    CURRENT_PATIENT_STATUS,
		    PMS_PATIENT_STATUS,
		    CURO_SUB_CONTRACT_ID,
		    DWH_CURRENT_FLAG,
		    PMS_ACCOUNT_ID,
		    IFNULL(PMS_PATIENT_CATEGORY,'0') AS PMS_PATIENT_CATEGORY,
		    FROM SNS_UKI_DSP_SNU.DIM_CURO_PATIENT_MASKED CP
		LEFT JOIN (
		    SELECT 
		    DISTINCT PATIENT_ID, 
		    FIRST_VALUE(REGIMEN_STATUS) OVER (PARTITION BY PATIENT_ID ORDER BY DELIVERY_DATE_ID DESC NULLS LAST) AS REGIMEN_STATUS
		FROM SNS_UKI_DSP_SNU.FACT_CURO_PATIENT_REGIMEN
		  WHERE UPPER(REGIMEN_STATUS) = 'ACTIVE') AS RS 
		ON CP.PATIENT_ID = RS.PATIENT_ID
		
		)
		,CCG_MAP AS
		(SELECT 'ANGUS HSCP' AS CCG_NAME,  'R149' AS CONTRACT_R_CODE UNION ALL
		SELECT 'CWM TAF MORG UNI' AS CCG_NAME,  'R215' AS CONTRACT_R_CODE UNION ALL
		SELECT 'DUMFRIES & GALLOWAY HSCP' AS CCG_NAME,  'R110' AS CONTRACT_R_CODE UNION ALL
		SELECT 'BETSI CADWALADR UNI' AS CCG_NAME,  'R485' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS CITY AND HACKNEY CCG' AS CCG_NAME,  'R154' AS CONTRACT_R_CODE UNION ALL
		SELECT 'ABERDEEN CITY HSCP' AS CCG_NAME,  'R116' AS CONTRACT_R_CODE UNION ALL
		SELECT 'GUERNSEY' AS CCG_NAME,  'R479' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HEYWD MIDD ROCHD CCG' AS CCG_NAME,  'R171' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BRENT CCG' AS CCG_NAME,  'R169' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NORTH EAST ESSEX CCG' AS CCG_NAME,  'R501' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS ASHFORD CCG' AS CCG_NAME,  'R032' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WINDS ASC MAIDEN CCG' AS CCG_NAME,  'R132' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BARKNG & DAGENHM CCG' AS CCG_NAME,  'R016' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS LIVERPOOL CCG' AS CCG_NAME,  'R142' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS LEEDS NORTH CCG' AS CCG_NAME,  'R138' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NEWCASTLE N & E CCG' AS CCG_NAME,  'R033' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BEDFORDSHIRE CCG' AS CCG_NAME,  'R018' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BARNSLEY CCG' AS CCG_NAME,  'R168' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BRIGHTON & HOVE CCG' AS CCG_NAME,  'R004' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NORTH HAMPSHIRE CCG' AS CCG_NAME,  'R133' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS N & W READING CCG' AS CCG_NAME,  'R132' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NORWICH CCG' AS CCG_NAME,  'R166' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS CAMDEN CCG' AS CCG_NAME,  'R153' AS CONTRACT_R_CODE UNION ALL
		SELECT 'CARDIFF & VALE UNIVERSTY' AS CCG_NAME,  'R217' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS CANNOCK CHASE CCG' AS CCG_NAME,  'R140' AS CONTRACT_R_CODE UNION ALL
		SELECT 'CHESHIRE CCG' AS CCG_NAME,  'R161' AS CONTRACT_R_CODE UNION ALL
		SELECT 'CWM TAF MORG UNIV LHB' AS CCG_NAME,  'R215' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS FAREHAM & GOSPRT CCG' AS CCG_NAME,  'R133' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS FYLDE & WYRE CCG' AS CCG_NAME,  'R137' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS CHORLEY & S RIBB CCG' AS CCG_NAME,  'R172' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS EREWASH CCG' AS CCG_NAME,  'R022' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BRADFORD CITY CCG' AS CCG_NAME,  'R139' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HIGH WLD LEW HAV CCG' AS CCG_NAME,  'R031' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS MILTON KEYNES CCG' AS CCG_NAME,  'R152' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS LAMBETH CCG' AS CCG_NAME,  'R037' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS E LEICESTR & RUT CCG' AS CCG_NAME,  'R045' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS TAMESIDE GLOSSOP CCG' AS CCG_NAME,  'R211' AS CONTRACT_R_CODE UNION ALL
		SELECT 'ABERDEENSHIRE HSCP' AS CCG_NAME,  'R116' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS ISLE OF WIGHT CCG' AS CCG_NAME,  'R134' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SCARBORO RYEDALE CCG' AS CCG_NAME,  'R098' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NEWHAM CCG' AS CCG_NAME,  'R154' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS EAST LANCASHIRE CCG' AS CCG_NAME,  'R150' AS CONTRACT_R_CODE UNION ALL
		-- SELECT 'NHS NEWCASTLE N & E CCG' AS CCG_NAME,  'R076' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NE HANTS & FARNM CCG' AS CCG_NAME,  'R027' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WALTHAM FOREST CCG' AS CCG_NAME,  'R016' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WANDSWORTH CCG' AS CCG_NAME,  'R008' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOUTH CHESHIRE CCG' AS CCG_NAME,  'R209' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS CASTLE PT & ROCH CCG' AS CCG_NAME,  'R136' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS KNOWSLEY CCG' AS CCG_NAME,  'R147' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS ROTHERHAM CCG' AS CCG_NAME,  'R167' AS CONTRACT_R_CODE UNION ALL
		SELECT 'DERBY & DERBYSHIRE CCG' AS CCG_NAME,  'R480' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS THANET CCG' AS CCG_NAME,  'R032' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BROMLEY CCG' AS CCG_NAME,  'R025' AS CONTRACT_R_CODE UNION ALL
		SELECT 'ANEURIN BEVAN' AS CCG_NAME,  'R484' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS N WEST SURREY CCG' AS CCG_NAME,  'R040' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS KINGSTON CCG' AS CCG_NAME,  'R008' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOUTH NORFOLK CCG' AS CCG_NAME,  'R166' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NORTH DURHAM CCG' AS CCG_NAME,  'R006' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS LEEDS WEST CCG' AS CCG_NAME,  'R138' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS GREENWICH CCG' AS CCG_NAME,  'R522' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS MANSFLD & ASHFLD CCG' AS CCG_NAME,  'R014' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BURY CCG' AS CCG_NAME,  'R171' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HOUNSLOW CCG' AS CCG_NAME,  'R180' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS MEDWAY CCG' AS CCG_NAME,  'R135' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS COVENTRY & RUGBY CCG' AS CCG_NAME,  'R525' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS OLDHAM CCG' AS CCG_NAME,  'R171' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS S LINCOLNSHIRE CCG' AS CCG_NAME,  'R141' AS CONTRACT_R_CODE UNION ALL
		SELECT 'CLACKMAN & STIRLING HSCP' AS CCG_NAME,  'R111' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS MORECAMBE BAY CCG' AS CCG_NAME,  'R038' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NEWBURY AND DIST CCG' AS CCG_NAME,  'R132' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NENE CCG' AS CCG_NAME,  'R176' AS CONTRACT_R_CODE UNION ALL
		SELECT 'JERSEY' AS CCG_NAME,  'R019' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS E & N HERTS CCG' AS CCG_NAME,  'R164' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HAMB RICH WHITBY CCG' AS CCG_NAME,  'R006' AS CONTRACT_R_CODE UNION ALL
		SELECT 'HYWEL DDA' AS CCG_NAME,  'R488' AS CONTRACT_R_CODE UNION ALL
		SELECT 'EAST LOTHIAN HSCP' AS CCG_NAME,  'R117' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS COASTAL W SUSSEX CCG' AS CCG_NAME,  'R004' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SWALE CCG' AS CCG_NAME,  'R032' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOUTHAMPTON CCG' AS CCG_NAME,  'R009' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SALFORD CCG' AS CCG_NAME,  'R143' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HARROW CCG' AS CCG_NAME,  'R169' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HARINGEY CCG' AS CCG_NAME,  'R153' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HEREFORDSHIRE CCG' AS CCG_NAME,  'R174' AS CONTRACT_R_CODE UNION ALL
		SELECT 'ISLE OF MAN' AS CCG_NAME,  'R175' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS ISLINGTON CCG' AS CCG_NAME,  'R153' AS CONTRACT_R_CODE UNION ALL
		SELECT 'EDINBURGH HSCP' AS CCG_NAME,  'R117' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS CORBY CCG' AS CCG_NAME,  'R176' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HORSHM & MID SUS CCG' AS CCG_NAME,  'R004' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SURREY DOWNS CCG' AS CCG_NAME,  'R008' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS OXFORDSHIRE CCG' AS CCG_NAME,  'R158' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NORTH KIRKLEES CCG' AS CCG_NAME,  'R482' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BASLDN & BRENTWD CCG' AS CCG_NAME,  'R136' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS CENTRAL LONDON CCG' AS CCG_NAME,  'R162' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS EAST SURREY CCG' AS CCG_NAME,  'R157' AS CONTRACT_R_CODE UNION ALL
		SELECT 'WEST LOTHIAN HSCP' AS CCG_NAME,  'R117' AS CONTRACT_R_CODE UNION ALL
		SELECT 'WEST DUNBARTONSHIRE HSCP' AS CCG_NAME,  'R112' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS REDBRIDGE CCG' AS CCG_NAME,  'R016' AS CONTRACT_R_CODE UNION ALL
		SELECT 'GLASGOW CITY HSCP' AS CCG_NAME,  'R112' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WIRRAL CCG' AS CCG_NAME,  'R219' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WOKINGHAM CCG' AS CCG_NAME,  'R132' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS IPSWICH & E SUFF CCG' AS CCG_NAME,  'R501' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS S GLOUCESTERSHRE CCG' AS CCG_NAME,  'R026' AS CONTRACT_R_CODE UNION ALL
		SELECT 'INVERCLYDE HSCP' AS CCG_NAME,  'R112' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HARDWICK CCG' AS CCG_NAME,  'R480' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS EAST STAFFORDSHR CCG' AS CCG_NAME,  'R140' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HARTLEPL & S-O-T CCG' AS CCG_NAME,  'R006' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HAVERING CCG' AS CCG_NAME,  'R016' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS DARLINGTON CCG' AS CCG_NAME,  'R006' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS LEICESTER CITY CCG' AS CCG_NAME,  'R045' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NORTH DERBYSHIRE CCG' AS CCG_NAME,  'R480' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WARRINGTON CCG' AS CCG_NAME,  'R013' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BLACKPOOL CCG' AS CCG_NAME,  'R137' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS CRAWLEY CCG' AS CCG_NAME,  'R157' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BMNGHM CROSS CTY CCG' AS CCG_NAME,  'R001' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS LUTON CCG' AS CCG_NAME,  'R018' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS GREATER PRESTON CCG' AS CCG_NAME,  'R172' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS REDD & BROMSGRV CCG' AS CCG_NAME,  'R529' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS GLOUCESTERSHIRE CCG' AS CCG_NAME,  'R030' AS CONTRACT_R_CODE UNION ALL
		SELECT 'FIFE HSCP' AS CCG_NAME,  'R148' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NORTHUMBERLAND CCG' AS CCG_NAME,  'R076' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NOTTINGHAM WEST CCG' AS CCG_NAME,  'R014' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOLIHULL CCG' AS CCG_NAME,  'R001' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WEST CHESHIRE CCG' AS CCG_NAME,  'R161' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS DORSET CCG' AS CCG_NAME,  'R020' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS KERNOW CCG' AS CCG_NAME,  'R131' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOUTH SEFTON CCG' AS CCG_NAME,  'R142' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HAMMERSMTH FULHM CCG' AS CCG_NAME,  'R169' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS CANTERBY & COAST CCG' AS CCG_NAME,  'R032' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS RUSHCLIFFE CCG' AS CCG_NAME,  'R014' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS TELFORD & WREKIN CCG' AS CCG_NAME,  'R140' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS DONCASTER CCG' AS CCG_NAME,  'R021' AS CONTRACT_R_CODE UNION ALL
		SELECT 'EAST AYRSHIRE HSCP' AS CCG_NAME,  'R159' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOUTH MANCHESTER CCG' AS CCG_NAME,  'R512' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BIRMINGHAM S & C CCG' AS CCG_NAME,  'R001' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BRACKNLL & ASCOT CCG' AS CCG_NAME,  'R132' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HALTON CCG' AS CCG_NAME,  'R013' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS GTR HUDDERSFIELD CCG' AS CCG_NAME,  'R482' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOUTHERN DERBYSH CCG' AS CCG_NAME,  'R022' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOUTHWARK CCG' AS CCG_NAME,  'R037' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS DEVON CCG' AS CCG_NAME,  'R131' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS N LINCOLNSHIRE CCG' AS CCG_NAME,  'R121' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS MERTON CCG' AS CCG_NAME,  'R008' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NEWARK & SHERWD CCG' AS CCG_NAME,  'R014' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SWINDON CCG' AS CCG_NAME,  'R003' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOUTH WORCS CCG' AS CCG_NAME,  'R529' AS CONTRACT_R_CODE UNION ALL
		SELECT 'ARGYLL & BUTE HSCP' AS CCG_NAME,  'R113' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WOLVERHAMPTON CCG' AS CCG_NAME,  'R524' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WYRE FOREST CCG' AS CCG_NAME,  'R529' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NORTH AYRSHIRE HSCP' AS CCG_NAME,  'R159' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NORTH LANARKSHIRE HSCP' AS CCG_NAME,  'R160' AS CONTRACT_R_CODE UNION ALL
		SELECT 'ORKNEY HEALTH & CARE' AS CCG_NAME,  'R118' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOUTH TYNESIDE CCG' AS CCG_NAME,  'R007' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS TOWER HAMLETS CCG' AS CCG_NAME,  'R154' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS RICHMOND CCG' AS CCG_NAME,  'R008' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NE LINCOLNSHIRE CCG' AS CCG_NAME,  'R121' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS CROYDON CCG' AS CCG_NAME,  'R008' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS LINCOLNSHIRE E CCG' AS CCG_NAME,  'R141' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SW LINCOLNSHIRE CCG' AS CCG_NAME,  'R024' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BEXLEY CCG' AS CCG_NAME,  'R521' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOUTH KENT COAST CCG' AS CCG_NAME,  'R032' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS GUILDFRD & WAVER CCG' AS CCG_NAME,  'R040' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS TRAFFORD CCG' AS CCG_NAME,  'R514' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS LEEDS S & E CCG' AS CCG_NAME,  'R138' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SANDWLL W BMNGHM CCG' AS CCG_NAME,  'R532' AS CONTRACT_R_CODE UNION ALL
		SELECT 'MORAY HSCP' AS CCG_NAME,  'R116' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NOTTINGHAM N & E CCG' AS CCG_NAME,  'R014' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HILLINGDON CCG' AS CCG_NAME,  'R165' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS THURROCK CCG' AS CCG_NAME,  'R136' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WEST LANCASHIRE CCG' AS CCG_NAME,  'R146' AS CONTRACT_R_CODE UNION ALL
		SELECT 'RENFREWSHIRE HSCP' AS CCG_NAME,  'R112' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOUTHEND CCG' AS CCG_NAME,  'R136' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS LINCOLNSHIRE W CCG' AS CCG_NAME,  'R141' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS ST HELENS CCG' AS CCG_NAME,  'R147' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HASTINGS & ROTHR CCG' AS CCG_NAME,  'R031' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NORTH MANCHESTER CCG' AS CCG_NAME,  'R171' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BRISTOL CCG' AS CCG_NAME,  'R026' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS STAFFORD & SURR CCG' AS CCG_NAME,  'R140' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS STOKE ON TRENT CCG' AS CCG_NAME,  'R140' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS E RIDING OF YORK CCG' AS CCG_NAME,  'R036' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NORTH SOMERSET CCG' AS CCG_NAME,  'R026' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS EASTERN CHESHIRE CCG' AS CCG_NAME,  'R209' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SLOUGH CCG' AS CCG_NAME,  'R132' AS CONTRACT_R_CODE UNION ALL
		SELECT 'FALKIRK HSCP' AS CCG_NAME,  'R111' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NOTTINGHAM CITY CCG' AS CCG_NAME,  'R014' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SHROPSHIRE CCG' AS CCG_NAME,  'R140' AS CONTRACT_R_CODE UNION ALL
		SELECT 'DUNDEE HSCP' AS CCG_NAME,  'R149' AS CONTRACT_R_CODE UNION ALL
		SELECT 'EAST RENFREWSHIRE HSCP' AS CCG_NAME,  'R112' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS CHILTERN CCG' AS CCG_NAME,  'R152' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS STOCKPORT CCG' AS CCG_NAME,  'R214' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS AYLESBURY VALE CCG' AS CCG_NAME,  'R152' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS DUDLEY CCG' AS CCG_NAME,  'R523' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SUTTON CCG' AS CCG_NAME,  'R008' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOUTHPT & FORMBY CCG' AS CCG_NAME,  'R146' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS EALING CCG' AS CCG_NAME,  'R163' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS DARTF GRVES SWAN CCG' AS CCG_NAME,  'R135' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS VALE OF YORK CCG' AS CCG_NAME,  'R098' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS VALE ROYAL CCG' AS CCG_NAME,  'R209' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BRADFORD DIST CCG' AS CCG_NAME,  'R139' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOUTH READING CCG' AS CCG_NAME,  'R132' AS CONTRACT_R_CODE UNION ALL
		SELECT 'WESTERN ISLES HSCP' AS CCG_NAME,  'R114' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOUTH TEES CCG' AS CCG_NAME,  'R006' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS DURH EASING SEDG CCG' AS CCG_NAME,  'R006' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HULL CCG' AS CCG_NAME,  'R036' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WARWICKSHIRE N CCG' AS CCG_NAME,  'R525' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WEST ESSEX CCG' AS CCG_NAME,  'R034' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WEST HAMPSHIRE CCG' AS CCG_NAME,  'R009' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WEST KENT CCG' AS CCG_NAME,  'R135' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS W LEICESTERSHIRE CCG' AS CCG_NAME,  'R045' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WAKEFIELD CCG' AS CCG_NAME,  'R170' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WALSALL CCG' AS CCG_NAME,  'R531' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WEST LONDON CCG' AS CCG_NAME,  'R169' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WEST NORFOLK CCG' AS CCG_NAME,  'R166' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WILTSHIRE CCG' AS CCG_NAME,  'R003' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WEST SUFFOLK CCG' AS CCG_NAME,  'R151' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WIGAN BOROUGH CCG' AS CCG_NAME,  'R182' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SUNDERLAND CCG' AS CCG_NAME,  'R007' AS CONTRACT_R_CODE UNION ALL
		SELECT 'SCOTTISH BORDERS HSCP' AS CCG_NAME,  'R115' AS CONTRACT_R_CODE UNION ALL
		SELECT 'SHETLAND HSCP' AS CCG_NAME,  'R119' AS CONTRACT_R_CODE UNION ALL
		SELECT 'SOUTH AYRSHIRE HSCP' AS CCG_NAME,  'R159' AS CONTRACT_R_CODE UNION ALL
		SELECT 'SOUTH LANARKSHIRE HSCP' AS CCG_NAME,  'R160' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS N STAFFORDSHIRE CCG' AS CCG_NAME,  'R140' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS MID ESSEX CCG' AS CCG_NAME,  'R136' AS CONTRACT_R_CODE UNION ALL
		SELECT 'SWANSEA BAY UNI' AS CCG_NAME,  'R130' AS CONTRACT_R_CODE UNION ALL
		-- SELECT 'SWANSEA BAY UNI' AS CCG_NAME,  'R130' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS CAMBRDG & PBORO CCG' AS CCG_NAME,  'R024' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BASSETLAW CCG' AS CCG_NAME,  'R021' AS CONTRACT_R_CODE UNION ALL
		SELECT 'Central Manchester (Paediatrics)' AS CCG_NAME,  'R145' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SE STAFFS & SEIS CCG' AS CCG_NAME,  'R140' AS CONTRACT_R_CODE UNION ALL
		SELECT 'PERTH & KINROSS HSCP' AS CCG_NAME,  'R149' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BARNET CCG' AS CCG_NAME,  'R153' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BANES CCG' AS CCG_NAME,  'R003' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS LEWISHAM CCG' AS CCG_NAME,  'R037' AS CONTRACT_R_CODE UNION ALL
		SELECT 'MIDLOTHIAN HSCP' AS CCG_NAME,  'R117' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NORTH NORFOLK CCG' AS CCG_NAME,  'R166' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS PORTSMOUTH CCG' AS CCG_NAME,  'R133' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SHEFFIELD CCG' AS CCG_NAME,  'R010' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BOLTON CCG' AS CCG_NAME,  'R144' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS AIRED WHARF CRVE CCG' AS CCG_NAME,  'R029' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS ENFIELD CCG' AS CCG_NAME,  'R153' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SURREY HEATH CCG' AS CCG_NAME,  'R027' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS GT YARMTH & WAVE CCG' AS CCG_NAME,  'R166' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS CALDERDALE CCG' AS CCG_NAME,  'R482' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HERTS VALLEYS CCG' AS CCG_NAME,  'R164' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HARROGT & RURAL CCG' AS CCG_NAME,  'R002' AS CONTRACT_R_CODE UNION ALL
		SELECT 'HIGHLAND HSCP' AS CCG_NAME,  'R113' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NEWCASTLE WEST CCG' AS CCG_NAME,  'R076' AS CONTRACT_R_CODE UNION ALL
		SELECT 'EAST DUNBARTONSHIRE HSCP' AS CCG_NAME,  'R112' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOMERSET CCG' AS CCG_NAME,  'R020' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOUTH WARWICKSHR CCG' AS CCG_NAME,  'R525' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS S EASTERN HANTS CCG' AS CCG_NAME,  'R133' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS CENTRAL MANCHSTR CCG' AS CCG_NAME,  'R514' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS EASTB HAILS SEAF CCG' AS CCG_NAME,  'R031' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BLACKB WTH DARWN CCG' AS CCG_NAME,  'R150' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NORTH TYNESIDE CCG' AS CCG_NAME,  'R076' AS CONTRACT_R_CODE UNION ALL
		SELECT 'POWYS TEACHING' AS CCG_NAME,  'R491' AS CONTRACT_R_CODE UNION ALL
		SELECT 'BRADFD DIST & CRAVEN CCG' AS CCG_NAME,  'R139' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NORTH CUMBRIA CCG' AS CCG_NAME,  'R076' AS CONTRACT_R_CODE UNION ALL
		SELECT 'HEREFORDSHRE & WORCS CCG' AS CCG_NAME,  'R174' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS GATESHEAD CCG' AS CCG_NAME,  'R033' AS CONTRACT_R_CODE
		),
		
		CTR_ID AS (
		SELECT CONTRACT_R_CODE, D.CONTRACT_ID, ROW_NUMBER() OVER(PARTITION BY CONTRACT_R_CODE ORDER BY D.CONTRACT_ID ASC) AS TES  FROM CCG_MAP
		LEFT JOIN PRD_SNS_UKI.SNS_UKI_DSP_SNU.DIM_MEDICAL_CONTRACT D ON CCG_MAP.CONTRACT_R_CODE = D.GROUP_ID
		),
		
		CTR_ID2 AS (
		SELECT CONTRACT_R_CODE,CONTRACT_ID FROM CTR_ID WHERE TES = 1)
		
		
		SELECT
		SOURCE,
		CONTRACT_ID,
		CONTRACT_R_ID,
		CURO_SUB_CONTRACT_ID,
		SALES_CHANNEL_ID,
		PRODUCT_ID,
		GEOGRAPHY_ID,
		PUMP_DATE,
		MEASURE_NAME,
		MEASURE_VALUE
		FROM(
		Select  
		'Homeward Sales' as SOURCE,
		S.CONTRACT_ID,
		MD.CONTRACT_R_ID,
		PA.CURO_SUB_CONTRACT_ID,
		S.SALES_CHANNEL_ID,
		S.PRODUCT_ID,
		S.GEOGRAPHY_ID,
		NULL as PUMP_DATE,
		SUM(INVOICE_ACTUAL_QUANTITY_SINGLE)::NUMBER(38,2) as Volumes_in_Units, --Invoice_Units,
		SUM(SUBTOTAL_5_PRICING_COND_GBP)::NUMBER(38,2) + sum(VAT_VALUE_GBP)::NUMBER(38,2) as Invoiced_Sales, --Total_Invoice,
		SUM(INVOICE_ACTUAL_QUANTITY_SINGLE* P.FP10_PRICE)::NUMBER(38,2) as FP10_PRICE
		  FROM  SNS_UKI_DSP_SNU.FACT_SALES_INVOICE S
		  LEFT JOIN  SNS_UKI_DSP_SNU.DIM_PRODUCT P ON S.PRODUCT_ID= P.PRODUCT_ID
		  LEFT JOIN SNS_UKI_DSP_SNU.DIM_CURO_PATIENT PA ON PA.PATIENT_ID=S.PATIENT_ID
		  LEFT JOIN PRD_SNS_UKI.SNS_UKI_DSP_SNU.DIM_MEDICAL_CONTRACT MD ON MD.CONTRACT_ID=S.CONTRACT_ID
		  WHERE S.INVOICE_DATE_ID <=(SELECT STARTDATE from MAX_MTH)  and S.INVOICE_DATE_ID  >= (SELECT ENDDATE from MAX_MTH) --last iqvia year
		  -- WHERE SUBSTR(S.INVOICE_DATE_ID,1,6)=SUBSTR((SELECT STARTDATE from MAX_MTH),1,6)  -- last IQVIA month data
		  -- WHERE S.INVOICE_DATE_ID <= 20241031 and S.INVOICE_DATE_ID >= 20231101
		  and S.SALES_CHANNEL_ID in (2)
		  and S.product_id <> 2071
		  and S.ORDER_REASON_CODE not in ('ZMA', 'ZIL', 'ZMK', 'ZIT')
		  group by 
		  SOURCE,
		  S.CONTRACT_ID,
		  MD.CONTRACT_R_ID,
		  PA.CURO_SUB_CONTRACT_ID,
		  S.SALES_CHANNEL_ID,
		  S.PRODUCT_ID,
		  S.GEOGRAPHY_ID,
		  PUMP_DATE
		)UNPIVOT(MEASURE_VALUE FOR MEASURE_NAME IN (Volumes_in_Units,Invoiced_Sales,FP10_PRICE)) 
		
		UNION ALL
		
		(
		    SELECT  'PATIENT NUMBERS' AS SOURCE,
		    B.CONTRACT_ID,
		    B.CONTRACT_R_ID,
		    A.CURO_SUB_CONTRACT_ID,
		    NULL AS SALES_CHANNEL_ID,
		    NULL AS PRODUCT_ID,
		    NULL AS GEOGRAPHY_ID,
		    NULL AS PUMP_DATE,
		    'NUM_OF_ACTIVE_PATIENT' AS MEASURE_NAME,
		    COUNT(DISTINCT(PMS_ACCOUNT_ID)) AS MEASURE_VALUE
		    FROM DIM_CURO_ACTIVE_PATIENT A
		    LEFT JOIN SNS_UKI_DSP_SNU.DIM_MEDICAL_CONTRACT B ON A.CURO_SUB_CONTRACT_ID = B.CURO_SUB_CONTRACT_ID
		    WHERE UPPER(PMS_PATIENT_STATUS)='ACTIVE'
		    AND UPPER(PMS_PATIENT_CATEGORY) NOT IN ('PUMP ONLY')
		    AND (SELECT MONTHEND_TZ FROM MAX_MTH) BETWEEN DWH_START_DATE AND DWH_END_DATE
		    GROUP BY CONTRACT_ID,B.CONTRACT_R_ID,A.CURO_SUB_CONTRACT_ID
		    
		    UNION
		    
		    SELECT  'PATIENT NUMBERS' AS SOURCE,
		    B.CONTRACT_ID,
		    B.CONTRACT_R_ID,
		    A.CURO_SUB_CONTRACT_ID,
		    NULL AS SALES_CHANNEL_ID,
		    NULL AS PRODUCT_ID,
		    NULL AS GEOGRAPHY_ID,
		    NULL AS PUMP_DATE,
		    'NUM_OF_STARTED_PATIENT' AS MEASURE_NAME,
		    COUNT(DISTINCT(PMS_ACCOUNT_ID)) AS MEASURE_VALUE
		    FROM SNS_UKI_DSP_SNU.DIM_CURO_PATIENT A
		    LEFT JOIN SNS_UKI_DSP_SNU.DIM_MEDICAL_CONTRACT B ON A.CURO_SUB_CONTRACT_ID = B.CURO_SUB_CONTRACT_ID
		    WHERE UPPER(FAX) = 'PATIENT ACTIVATED' 
		    AND A.DWH_CURRENT_FLAG = 1 
		    AND A.CURO_SUB_CONTRACT_ID <> 0 
		    AND PMS_START_DATE BETWEEN (SELECT MONTHSTART_TZ FROM MAX_MTH) AND (SELECT MONTHEND_TZ FROM MAX_MTH) 
		    GROUP BY CONTRACT_ID,B.CONTRACT_R_ID,A.CURO_SUB_CONTRACT_ID
		    
		    UNION
		    
		    SELECT  'PATIENT NUMBERS' AS SOURCE,
		    B.CONTRACT_ID,
		    B.CONTRACT_R_ID,
		    A.CURO_SUB_CONTRACT_ID,
		    NULL AS SALES_CHANNEL_ID,
		    NULL AS PRODUCT_ID,
		    NULL AS GEOGRAPHY_ID,
		    NULL AS PUMP_DATE,
		    'NUM_OF_STOPPED_PATIENT' AS MEASURE_NAME,
		    COUNT(DISTINCT(PMS_ACCOUNT_ID)) AS MEASURE_VALUE
		    FROM SNS_UKI_DSP_SNU.DIM_CURO_PATIENT A
		    LEFT JOIN SNS_UKI_DSP_SNU.DIM_MEDICAL_CONTRACT B ON A.CURO_SUB_CONTRACT_ID = B.CURO_SUB_CONTRACT_ID
		    WHERE UPPER(FAX) = 'PATIENT ACTIVATED' 
		    AND UPPER(PMS_PATIENT_STATUS) IN ('DECEASED', 'OFF SCHEME')
		    AND PMS_STOP_DATE BETWEEN (SELECT MONTHSTART_TZ FROM MAX_MTH) AND (SELECT MONTHEND_TZ FROM MAX_MTH) 
		    GROUP BY CONTRACT_ID,B.CONTRACT_R_ID,A.CURO_SUB_CONTRACT_ID
		
		)
		
		
		
		UNION ALL
		
		
		SELECT
		SOURCE,
		CONTRACT_ID,
		CONTRACT_R_ID,
		CURO_SUB_CONTRACT_ID,
		SALES_CHANNEL_ID,
		PRODUCT_ID,
		GEOGRAPHY_ID,
		PUMP_DATE,
		MEASURE_NAME,
		MEASURE_VALUE
		FROM(
		select 'Hospital' as Source,
		S.CONTRACT_ID,
		MD.CONTRACT_R_ID,
		PA.CURO_SUB_CONTRACT_ID,
		S.PRODUCT_ID,
		S.GEOGRAPHY_ID,
		S.SALES_CHANNEL_ID,
		null as PUMP_DATE,
		SUM(QUANTITY_PIECE)::NUMBER(38,2) as Volumes_in_Units,--as Channel_Sales_Singles,
		SUM(SALES_VALUE_GBP)::NUMBER(38,2) as Invoiced_Sales,-- Channel_Sales_GBP,
		sum(QUANTITY_PIECE* P.FP10_PRICE)::NUMBER(38,2) as FP10_PRICE
		FROM  SNS_UKI_DSP_SNU.FACT_CHANNEL_SALES S
		LEFT JOIN  SNS_UKI_DSP_SNU.DIM_PRODUCT P
		ON S.PRODUCT_ID= P.PRODUCT_ID
		LEFT JOIN SNS_UKI_DSP_SNU.DIM_CURO_PATIENT PA ON S.PATIENT_ID=PA.PATIENT_ID
		LEFT JOIN PRD_SNS_UKI.SNS_UKI_DSP_SNU.DIM_MEDICAL_CONTRACT MD ON MD.CONTRACT_ID=S.CONTRACT_ID
		WHERE DATE_ID <=(SELECT STARTDATE from MAX_MTH)  and DATE_ID  >= (SELECT ENDDATE from MAX_MTH) and S.sales_channel_id = 1  -- whole 1 year data
		-- WHERE SUBSTR(DATE_ID,1,6)=SUBSTR((SELECT STARTDATE from MAX_MTH),1,6) and S.sales_channel_id = 1  -- last IQVIA month data
		-- WHERE DATE_ID <= 20241031 and DATE_ID >= 20231101 AND S.sales_channel_id = 1
		group by 
		SOURCE,
		S.CONTRACT_ID,
		MD.CONTRACT_R_ID,
		PA.CURO_SUB_CONTRACT_ID,
		S.SALES_CHANNEL_ID,
		S.PRODUCT_ID,
		S.GEOGRAPHY_ID,
		PUMP_DATE
		)UNPIVOT(MEASURE_VALUE FOR MEASURE_NAME IN (Volumes_in_Units,Invoiced_Sales,FP10_PRICE)) 
		
		UNION ALL
		
		SELECT
		SOURCE,
		CONTRACT_ID,
		CONTRACT_R_ID,
		CURO_SUB_CONTRACT_ID,
		SALES_CHANNEL_ID,
		PRODUCT_ID,
		GEOGRAPHY_ID,
		PUMP_DATE,
		MEASURE_NAME,
		MEASURE_VALUE
		FROM (
		SELECT
		    
		   'Community' as SOURCE,
		    SALES_CHANNEL_ID,
		    PA.CURO_SUB_CONTRACT_ID,
		    MD.CONTRACT_R_ID,
		    CTR_ID2.CONTRACT_ID,
		    null as PUMP_DATE,
		    A.PRODUCT_ID as PRODUCT_ID ,
		    A.GEOGRAPHY_ID,
		    SUM(QUANTITY_PIECE)::NUMBER(38,2) as Volumes_in_Units,-- Community_Singles,
		    SUM(SALES_VALUE_GBP)::NUMBER(38,2) as Invoiced_Sales, --Community_Value_in_GBP
		FROM
		     SNS_UKI_DSP_SNU.FACT_CHANNEL_SALES_MONTHLY A
		LEFT JOIN SNS_UKI_DSP_SNU.DIM_CURO_PATIENT PA ON A.PATIENT_ID=PA.PATIENT_ID
		LEFT JOIN SNS_UKI_DSP_SNU.DIM_GEO_TERRITORY GEO ON A.GEOGRAPHY_ID = GEO.GEO_TERRITORY_ID
		LEFT JOIN SNS_UKI_DSP_SNU.DIM_GEO_CCG   CCG ON GEO.GEO_CCG_ID = CCG.GEO_CCG_ID
		LEFT JOIN CCG_MAP CCG_MAP ON CCG.CCG_NAME = CCG_MAP.CCG_NAME
		LEFT JOIN CTR_ID2 ON CTR_ID2.CONTRACT_R_CODE = CCG_MAP.CONTRACT_R_CODE
		join SNS_UKI_DSP_SNU.DIM_PRODUCT B ON A.PRODUCT_ID = B.PRODUCT_ID
		LEFT JOIN PRD_SNS_UKI.SNS_UKI_DSP_SNU.DIM_MEDICAL_CONTRACT MD ON MD.CONTRACT_ID=CTR_ID2.CONTRACT_ID
		join SNS_UKI_DSP_SNU.DIM_PRODUCT_HIER_LOCAL_6 C ON B.PROD_HIER_LOCAL_6_ID = C.PROD_HIER_LOCAL_6_ID
		join SNS_UKI_DSP_SNU.DIM_PRODUCT_HIER_LOCAL_5 D ON C.PROD_HIER_LOCAL_5_ID = D.PROD_HIER_LOCAL_5_ID
		join SNS_UKI_DSP_SNU.DIM_PRODUCT_HIER_LOCAL_4 E ON D.PROD_HIER_LOCAL_4_ID = E.PROD_HIER_LOCAL_4_ID
		join SNS_UKI_DSP_SNU.DIM_PRODUCT_HIER_LOCAL_3 F ON E.PROD_HIER_LOCAL_3_ID = F.PROD_HIER_LOCAL_3_ID AND F.PROD_HIER_LOCAL_3_ID <> 5675
		join SNS_UKI_DSP_SNU.DIM_PRODUCT_HIER_LOCAL_2 G ON F.PROD_HIER_LOCAL_2_ID = G.PROD_HIER_LOCAL_2_ID AND F.PROD_HIER_LOCAL_2_ID IN (745,6,11,746)
		WHERE to_char(MONTH_ID * 100 + 1) >= (SELECT ENDDATE FROM MAX_MTH) AND to_char(MONTH_ID * 100 + 1) <= (SELECT STARTDATE FROM MAX_MTH)  --last iqvia year
		  -- WHERE MONTH_ID=SUBSTR((SELECT STARTDATE from MAX_MTH),1,6)  -- last IQVIA month data
		AND SALES_CHANNEL_ID =3
		group by 
		SOURCE,
		CTR_ID2.CONTRACT_ID,
		MD.CONTRACT_R_ID,
		PA.CURO_SUB_CONTRACT_ID,
		SALES_CHANNEL_ID,
		A.PRODUCT_ID,
		A.GEOGRAPHY_ID,
		PUMP_DATE
		)UNPIVOT(MEASURE_VALUE FOR MEASURE_NAME IN (Volumes_in_Units,Invoiced_Sales)) 
		
		UNION ALL
		
		
		SELECT
		SOURCE,
		CONTRACT_ID,
		CONTRACT_R_ID,
		CURO_SUB_CONTRACT_ID,
		SALES_CHANNEL_ID,
		PRODUCT_ID,
		GEOGRAPHY_ID,
		PUMP_DATE,
		MEASURE_NAME,
		MEASURE_VALUE
		FROM (
		SELECT
		'PATIENT_PUMP' as Source,
		'2' AS SALES_CHANNEL_ID,
		CURO_SUB_CONTRACT_ID,
		PRODUCT_ID,
		GEOGRAPHY_ID,
		CONTRACT_ID,
		CONTRACT_R_ID,
		PUMP_DATE,
		PRODUCT_DESCRIPTION,
		INCLUDE_EXCLUDE,
		PUMP_MODEL,
		SUM(PUMP_COUNT) as PUMP_COUNT,
		SUM(PUMP_IN_SERVICE_COUNT) as PUMP_IN_SERVICE_COUNT ,
		SUM(PUMP_NOT_IN_SERVICE_COUNT) AS PUMP_NOT_IN_SERVICE_COUNT,
		FROM (
		SELECT
		T.PRODUCT_ID,
		PT.CURO_SUB_CONTRACT_ID,
		MC.CONTRACT_ID,
		MCR.CONTRACT_R_ID,
		T.GEOGRAPHY_ID,
		P.ACQUISITION_DATE as PUMP_DATE,
		P.PRODUCT_DESCRIPTION,
		CASE 
		    WHEN P.ACQUISITION_DATE < ADD_MONTHS(TO_DATE('20241031','YYYYMMDD'),-60) THEN 'EXCLUDE'
		    ELSE 'INCLUDE'
		END AS INCLUDE_EXCLUDE,
		CASE 
		    WHEN P.PRODUCT_DESCRIPTION='FLOCARE 800 ENTERAL PUMP' THEN 'Obsolete'
		    WHEN P.PRODUCT_DESCRIPTION='FLOCARE INFINITY III PUMP' THEN 'Infinity 3'
		    WHEN P.PRODUCT_DESCRIPTION='FLOCARE INFINITY PUMP' THEN 'Infinity 2'
		    WHEN P.PRODUCT_DESCRIPTION='FLOCARE INFINITY PUMP (125D)' THEN 'Obsolete'
		    WHEN P.PRODUCT_DESCRIPTION='FLOCARE INFINITY PLUS PUMP' THEN 'Infinity 2'
		    WHEN P.PRODUCT_DESCRIPTION='INFINITY PAGER' THEN 'Infinity 2'
		    WHEN P.PRODUCT_DESCRIPTION='APPLIX SMART PUMP' THEN 'Infinity 2'
		    ELSE 'Obsolete'
		END AS PUMP_MODEL,
		T.PUMP_COUNT,
		CASE WHEN P.NEXT_SERVICE_DATE >= (SELECT MONTHEND_TZ from MAX_MTH)
		     THEN T.PUMP_COUNT END PUMP_IN_SERVICE_COUNT,
		CASE WHEN P.NEXT_SERVICE_DATE < (SELECT MONTHEND_TZ from MAX_MTH) OR P.NEXT_SERVICE_DATE IS NULL
		     THEN T.PUMP_COUNT END PUMP_NOT_IN_SERVICE_COUNT
		-- PUMP_IN_SERVICE_COUNT,
		-- PUMP_NOT_IN_SERVICE_COUNT
		FROM SNS_UKI_DSP_SNU.FACT_PUMP_LOC_TRACK T 
		LEFT JOIN SNS_UKI_DSP_SNU.DIM_CURO_PATIENT PT ON PT.PATIENT_ID=T.PATIENT_ID
		LEFT JOIN SNS_UKI_DSP_SNU.DIM_PUMP P ON T.PUMP_ID=P.PUMP_ID
		LEFT join PRD_SNS_UKI.SNS_UKI_DSP_SNU.DIM_MEDICAL_CONTRACT MC on MC.CURO_SUB_CONTRACT_ID=PT.CURO_SUB_CONTRACT_ID
		LEFT JOIN PRD_SNS_UKI.SNS_UKI_DSP_SNU.DIM_MEDICAL_CONTRACT_R MCR ON MCR.CONTRACT_R_ID=MC.CONTRACT_R_ID
		WHERE UPPER(T.PUMP_LOCATION) = 'PATIENT'
		AND T.DATE_FROM <= (SELECT MONTHEND_TZ from MAX_MTH)
		AND T.DATE_TO >= (SELECT MONTHEND_TZ from MAX_MTH)
		-- AND PT.CURO_SUB_CONTRACT_ID<>0
		)
		GROUP BY 
		SOURCE,
		CURO_SUB_CONTRACT_ID,           
		SALES_CHANNEL_ID,
		PRODUCT_ID,
		CONTRACT_ID,
		CONTRACT_R_ID,
		GEOGRAPHY_ID,
		PUMP_DATE,
		PRODUCT_DESCRIPTION,
		INCLUDE_EXCLUDE,
		PUMP_MODEL
		)UNPIVOT(MEASURE_VALUE FOR MEASURE_NAME IN (PUMP_COUNT,PUMP_IN_SERVICE_COUNT,PUMP_NOT_IN_SERVICE_COUNT)) 
		
		UNION ALL
		
		SELECT
		SOURCE,
		CONTRACT_ID,
		CONTRACT_R_ID,
		CURO_SUB_CONTRACT_ID,
		SALES_CHANNEL_ID,
		PRODUCT_ID,
		GEOGRAPHY_ID,
		PUMP_DATE,
		MEASURE_NAME,
		MEASURE_VALUE
		FROM (
		SELECT
		'HOSPITAL_PUMP' as SOURCE,
		'1' as SALES_CHANNEL_ID,
		CURO_SUB_CONTRACT_ID,
		PRODUCT_ID,
		CONTRACT_ID,
		CONTRACT_R_ID,
		GEOGRAPHY_ID,
		PUMP_DATE,
		PRODUCT_DESCRIPTION,
		INCLUDE_EXCLUDE,
		PUMP_MODEL,
		SUM(PUMP_COUNT) as PUMP_COUNT,
		SUM(PUMP_IN_SERVICE_COUNT) as PUMP_IN_SERVICE_COUNT ,
		SUM(PUMP_NOT_IN_SERVICE_COUNT) AS PUMP_NOT_IN_SERVICE_COUNT
		FROM (
		SELECT
		T.PRODUCT_ID,
		T.PATIENT_ID,
		MC.CURO_SUB_CONTRACT_ID,
		T.CONTRACT_ID,
		T.GEOGRAPHY_ID,
		MC.CONTRACT_R_ID,
		P.ACQUISITION_DATE AS PUMP_DATE,
		P.PRODUCT_DESCRIPTION,
		CASE 
		    WHEN P.ACQUISITION_DATE < ADD_MONTHS(TO_DATE('20241031','YYYYMMDD'),-60) THEN 'EXCLUDE'
		    ELSE 'INCLUDE'
		END AS INCLUDE_EXCLUDE,
		CASE 
		    WHEN P.PRODUCT_DESCRIPTION='FLOCARE 800 ENTERAL PUMP' THEN 'Obsolete'
		    WHEN P.PRODUCT_DESCRIPTION='FLOCARE INFINITY III PUMP' THEN 'Infinity 3'
		    WHEN P.PRODUCT_DESCRIPTION='FLOCARE INFINITY PUMP' THEN 'Infinity 2'
		    WHEN P.PRODUCT_DESCRIPTION='FLOCARE INFINITY PUMP (125D)' THEN 'Obsolete'
		    WHEN P.PRODUCT_DESCRIPTION='FLOCARE INFINITY PLUS PUMP' THEN 'Infinity 2'
		    WHEN P.PRODUCT_DESCRIPTION='INFINITY PAGER' THEN 'Infinity 2'
		    WHEN P.PRODUCT_DESCRIPTION='APPLIX SMART PUMP' THEN 'Infinity 2'
		    ELSE 'Obsolete'
		END AS PUMP_MODEL,
		T.PUMP_COUNT,
		CASE WHEN P.NEXT_SERVICE_DATE >=(SELECT MONTHEND_TZ from MAX_MTH)
		     THEN T.PUMP_COUNT END PUMP_IN_SERVICE_COUNT,
		CASE WHEN P.NEXT_SERVICE_DATE < (SELECT MONTHEND_TZ from MAX_MTH) OR P.NEXT_SERVICE_DATE IS NULL
		     THEN T.PUMP_COUNT END PUMP_NOT_IN_SERVICE_COUNT
		-- PUMP_IN_SERVICE_COUNT,
		-- PUMP_NOT_IN_SERVICE_COUNT
		FROM
		SNS_UKI_DSP_SNU.FACT_PUMP_LOC_TRACK T 
		LEFT JOIN SNS_UKI_DSP_SNU.DIM_CURO_PATIENT PT ON PT.PATIENT_ID=T.PATIENT_ID
		LEFT JOIN SNS_UKI_DSP_SNU.DIM_PUMP P ON T.PUMP_ID=P.PUMP_ID
		LEFT join PRD_SNS_UKI.SNS_UKI_DSP_SNU.DIM_MEDICAL_CONTRACT MC on MC.CONTRACT_ID=T.CONTRACT_ID
		WHERE T.PUMP_LOCATION  IN ('WARD PUMP','POOL PUMP')
		AND T.DATE_FROM <= (SELECT MONTHEND_TZ from MAX_MTH)
		AND T.DATE_TO >= (SELECT MONTHEND_TZ from MAX_MTH)
		)
		GROUP BY
		SOURCE,
		SALES_CHANNEL_ID,
		CURO_SUB_CONTRACT_ID,
		PRODUCT_ID,
		GEOGRAPHY_ID,
		CONTRACT_ID,
		CONTRACT_R_ID,
		PUMP_DATE,
		PRODUCT_DESCRIPTION,
		INCLUDE_EXCLUDE,
		PUMP_MODEL
		)UNPIVOT(MEASURE_VALUE FOR MEASURE_NAME IN (PUMP_COUNT,PUMP_IN_SERVICE_COUNT,PUMP_NOT_IN_SERVICE_COUNT))
		
		-- where CONTRACT_ID <> '0' and CONTRACT_ID IS NOT NULL
		
		)
		
		
		", null, [EnableFolding=true])
		in
		Source */
		
		let x="" in x
		```
	lineageTag: 501a1417-88b4-4412-af40-dedc90e3c80d
	queryGroup: Archive

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Text

expression 'P&L_Pivot (og)' = ```
		/*let
		    Source = Value.NativeQuery(Snowflake.Databases("danone.west-europe.azure.snowflakecomputing.com","PRD_SNS_UKI_ANL_WH",[Implementation="2.0", Role="PRD_SNS_UKI_USER"]){[Name="PRD_SNS_UKI"]}[Data], 
		    "
		    SELECT
		FT.SOURCE,
		FT.CONTRACT_ID,
		FT.CONTRACT_R_ID,
		FT.CURO_SUB_CONTRACT_ID,
		FT.SALES_CHANNEL_ID,
		FT.PRODUCT_ID,
		FT.GEOGRAPHY_ID,
		FT.Volumes_in_Units, --Invoice_Units,
		FT.Invoiced_Sales, --Total_Invoice,
		FT.FP10_VALUE,
		FT.FP10_PRICE,
		PRD.PRODUCT_CODE
		FROM (
		With MAX_MTH AS
		(
		SELECT
		TO_NUMBER(TO_VARCHAR(LAST_DAY(TO_DATE(MAX('202503')|| '01','YYYYMMDD')),'YYYYMMDD')) AS STARTDATE,
		TO_NUMBER(TO_VARCHAR(ADD_MONTHS(TO_DATE(MAX('202503')|| '01','YYYYMMDD'),-11),'YYYYMMDD')) AS ENDDATE,
		LAST_DAY(TO_DATE(MAX('202503')|| '01','YYYYMMDD'))::TIMESTAMP_TZ AS MONTHEND_TZ,
		DATEADD(DAY,-1,LAST_DAY(TO_DATE(MAX('202503')|| '01','YYYYMMDD')))::TIMESTAMP_TZ AS MONTHEND_TZ1,
		TO_DATE(MAX('202503')|| '01','YYYYMMDD')::TIMESTAMP_TZ AS MONTHSTART_TZ
		)
		,CCG_MAP AS
		(SELECT 'ANGUS HSCP' AS CCG_NAME,  'R149' AS CONTRACT_R_CODE UNION ALL
		SELECT 'CWM TAF MORG UNI' AS CCG_NAME,  'R215' AS CONTRACT_R_CODE UNION ALL
		SELECT 'DUMFRIES & GALLOWAY HSCP' AS CCG_NAME,  'R110' AS CONTRACT_R_CODE UNION ALL
		SELECT 'BETSI CADWALADR UNI' AS CCG_NAME,  'R485' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS CITY AND HACKNEY CCG' AS CCG_NAME,  'R154' AS CONTRACT_R_CODE UNION ALL
		SELECT 'ABERDEEN CITY HSCP' AS CCG_NAME,  'R116' AS CONTRACT_R_CODE UNION ALL
		SELECT 'GUERNSEY' AS CCG_NAME,  'R479' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HEYWD MIDD ROCHD CCG' AS CCG_NAME,  'R171' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BRENT CCG' AS CCG_NAME,  'R169' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NORTH EAST ESSEX CCG' AS CCG_NAME,  'R501' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS ASHFORD CCG' AS CCG_NAME,  'R032' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WINDS ASC MAIDEN CCG' AS CCG_NAME,  'R132' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BARKNG & DAGENHM CCG' AS CCG_NAME,  'R016' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS LIVERPOOL CCG' AS CCG_NAME,  'R142' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS LEEDS NORTH CCG' AS CCG_NAME,  'R138' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NEWCASTLE N & E CCG' AS CCG_NAME,  'R033' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BEDFORDSHIRE CCG' AS CCG_NAME,  'R018' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BARNSLEY CCG' AS CCG_NAME,  'R168' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BRIGHTON & HOVE CCG' AS CCG_NAME,  'R004' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NORTH HAMPSHIRE CCG' AS CCG_NAME,  'R133' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS N & W READING CCG' AS CCG_NAME,  'R132' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NORWICH CCG' AS CCG_NAME,  'R166' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS CAMDEN CCG' AS CCG_NAME,  'R153' AS CONTRACT_R_CODE UNION ALL
		SELECT 'CARDIFF & VALE UNIVERSTY' AS CCG_NAME,  'R217' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS CANNOCK CHASE CCG' AS CCG_NAME,  'R140' AS CONTRACT_R_CODE UNION ALL
		SELECT 'CHESHIRE CCG' AS CCG_NAME,  'R161' AS CONTRACT_R_CODE UNION ALL
		SELECT 'CWM TAF MORG UNIV LHB' AS CCG_NAME,  'R215' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS FAREHAM & GOSPRT CCG' AS CCG_NAME,  'R133' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS FYLDE & WYRE CCG' AS CCG_NAME,  'R137' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS CHORLEY & S RIBB CCG' AS CCG_NAME,  'R172' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS EREWASH CCG' AS CCG_NAME,  'R022' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BRADFORD CITY CCG' AS CCG_NAME,  'R139' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HIGH WLD LEW HAV CCG' AS CCG_NAME,  'R031' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS MILTON KEYNES CCG' AS CCG_NAME,  'R152' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS LAMBETH CCG' AS CCG_NAME,  'R037' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS E LEICESTR & RUT CCG' AS CCG_NAME,  'R045' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS TAMESIDE GLOSSOP CCG' AS CCG_NAME,  'R211' AS CONTRACT_R_CODE UNION ALL
		SELECT 'ABERDEENSHIRE HSCP' AS CCG_NAME,  'R116' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS ISLE OF WIGHT CCG' AS CCG_NAME,  'R134' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SCARBORO RYEDALE CCG' AS CCG_NAME,  'R098' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NEWHAM CCG' AS CCG_NAME,  'R154' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS EAST LANCASHIRE CCG' AS CCG_NAME,  'R150' AS CONTRACT_R_CODE UNION ALL
		-- SELECT 'NHS NEWCASTLE N & E CCG' AS CCG_NAME,  'R076' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NE HANTS & FARNM CCG' AS CCG_NAME,  'R027' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WALTHAM FOREST CCG' AS CCG_NAME,  'R016' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WANDSWORTH CCG' AS CCG_NAME,  'R008' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOUTH CHESHIRE CCG' AS CCG_NAME,  'R209' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS CASTLE PT & ROCH CCG' AS CCG_NAME,  'R136' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS KNOWSLEY CCG' AS CCG_NAME,  'R147' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS ROTHERHAM CCG' AS CCG_NAME,  'R167' AS CONTRACT_R_CODE UNION ALL
		SELECT 'DERBY & DERBYSHIRE CCG' AS CCG_NAME,  'R480' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS THANET CCG' AS CCG_NAME,  'R032' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BROMLEY CCG' AS CCG_NAME,  'R025' AS CONTRACT_R_CODE UNION ALL
		SELECT 'ANEURIN BEVAN' AS CCG_NAME,  'R484' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS N WEST SURREY CCG' AS CCG_NAME,  'R040' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS KINGSTON CCG' AS CCG_NAME,  'R008' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOUTH NORFOLK CCG' AS CCG_NAME,  'R166' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NORTH DURHAM CCG' AS CCG_NAME,  'R006' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS LEEDS WEST CCG' AS CCG_NAME,  'R138' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS GREENWICH CCG' AS CCG_NAME,  'R522' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS MANSFLD & ASHFLD CCG' AS CCG_NAME,  'R014' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BURY CCG' AS CCG_NAME,  'R171' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HOUNSLOW CCG' AS CCG_NAME,  'R180' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS MEDWAY CCG' AS CCG_NAME,  'R135' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS COVENTRY & RUGBY CCG' AS CCG_NAME,  'R525' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS OLDHAM CCG' AS CCG_NAME,  'R171' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS S LINCOLNSHIRE CCG' AS CCG_NAME,  'R141' AS CONTRACT_R_CODE UNION ALL
		SELECT 'CLACKMAN & STIRLING HSCP' AS CCG_NAME,  'R111' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS MORECAMBE BAY CCG' AS CCG_NAME,  'R038' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NEWBURY AND DIST CCG' AS CCG_NAME,  'R132' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NENE CCG' AS CCG_NAME,  'R176' AS CONTRACT_R_CODE UNION ALL
		SELECT 'JERSEY' AS CCG_NAME,  'R019' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS E & N HERTS CCG' AS CCG_NAME,  'R164' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HAMB RICH WHITBY CCG' AS CCG_NAME,  'R006' AS CONTRACT_R_CODE UNION ALL
		SELECT 'HYWEL DDA' AS CCG_NAME,  'R488' AS CONTRACT_R_CODE UNION ALL
		SELECT 'EAST LOTHIAN HSCP' AS CCG_NAME,  'R117' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS COASTAL W SUSSEX CCG' AS CCG_NAME,  'R004' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SWALE CCG' AS CCG_NAME,  'R032' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOUTHAMPTON CCG' AS CCG_NAME,  'R009' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SALFORD CCG' AS CCG_NAME,  'R143' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HARROW CCG' AS CCG_NAME,  'R169' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HARINGEY CCG' AS CCG_NAME,  'R153' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HEREFORDSHIRE CCG' AS CCG_NAME,  'R174' AS CONTRACT_R_CODE UNION ALL
		SELECT 'ISLE OF MAN' AS CCG_NAME,  'R175' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS ISLINGTON CCG' AS CCG_NAME,  'R153' AS CONTRACT_R_CODE UNION ALL
		SELECT 'EDINBURGH HSCP' AS CCG_NAME,  'R117' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS CORBY CCG' AS CCG_NAME,  'R176' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HORSHM & MID SUS CCG' AS CCG_NAME,  'R004' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SURREY DOWNS CCG' AS CCG_NAME,  'R008' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS OXFORDSHIRE CCG' AS CCG_NAME,  'R158' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NORTH KIRKLEES CCG' AS CCG_NAME,  'R482' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BASLDN & BRENTWD CCG' AS CCG_NAME,  'R136' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS CENTRAL LONDON CCG' AS CCG_NAME,  'R162' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS EAST SURREY CCG' AS CCG_NAME,  'R157' AS CONTRACT_R_CODE UNION ALL
		SELECT 'WEST LOTHIAN HSCP' AS CCG_NAME,  'R117' AS CONTRACT_R_CODE UNION ALL
		SELECT 'WEST DUNBARTONSHIRE HSCP' AS CCG_NAME,  'R112' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS REDBRIDGE CCG' AS CCG_NAME,  'R016' AS CONTRACT_R_CODE UNION ALL
		SELECT 'GLASGOW CITY HSCP' AS CCG_NAME,  'R112' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WIRRAL CCG' AS CCG_NAME,  'R219' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WOKINGHAM CCG' AS CCG_NAME,  'R132' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS IPSWICH & E SUFF CCG' AS CCG_NAME,  'R501' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS S GLOUCESTERSHRE CCG' AS CCG_NAME,  'R026' AS CONTRACT_R_CODE UNION ALL
		SELECT 'INVERCLYDE HSCP' AS CCG_NAME,  'R112' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HARDWICK CCG' AS CCG_NAME,  'R480' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS EAST STAFFORDSHR CCG' AS CCG_NAME,  'R140' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HARTLEPL & S-O-T CCG' AS CCG_NAME,  'R006' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HAVERING CCG' AS CCG_NAME,  'R016' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS DARLINGTON CCG' AS CCG_NAME,  'R006' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS LEICESTER CITY CCG' AS CCG_NAME,  'R045' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NORTH DERBYSHIRE CCG' AS CCG_NAME,  'R480' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WARRINGTON CCG' AS CCG_NAME,  'R013' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BLACKPOOL CCG' AS CCG_NAME,  'R137' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS CRAWLEY CCG' AS CCG_NAME,  'R157' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BMNGHM CROSS CTY CCG' AS CCG_NAME,  'R001' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS LUTON CCG' AS CCG_NAME,  'R018' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS GREATER PRESTON CCG' AS CCG_NAME,  'R172' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS REDD & BROMSGRV CCG' AS CCG_NAME,  'R529' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS GLOUCESTERSHIRE CCG' AS CCG_NAME,  'R030' AS CONTRACT_R_CODE UNION ALL
		SELECT 'FIFE HSCP' AS CCG_NAME,  'R148' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NORTHUMBERLAND CCG' AS CCG_NAME,  'R076' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NOTTINGHAM WEST CCG' AS CCG_NAME,  'R014' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOLIHULL CCG' AS CCG_NAME,  'R001' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WEST CHESHIRE CCG' AS CCG_NAME,  'R161' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS DORSET CCG' AS CCG_NAME,  'R020' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS KERNOW CCG' AS CCG_NAME,  'R131' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOUTH SEFTON CCG' AS CCG_NAME,  'R142' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HAMMERSMTH FULHM CCG' AS CCG_NAME,  'R169' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS CANTERBY & COAST CCG' AS CCG_NAME,  'R032' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS RUSHCLIFFE CCG' AS CCG_NAME,  'R014' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS TELFORD & WREKIN CCG' AS CCG_NAME,  'R140' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS DONCASTER CCG' AS CCG_NAME,  'R021' AS CONTRACT_R_CODE UNION ALL
		SELECT 'EAST AYRSHIRE HSCP' AS CCG_NAME,  'R159' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOUTH MANCHESTER CCG' AS CCG_NAME,  'R512' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BIRMINGHAM S & C CCG' AS CCG_NAME,  'R001' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BRACKNLL & ASCOT CCG' AS CCG_NAME,  'R132' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HALTON CCG' AS CCG_NAME,  'R013' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS GTR HUDDERSFIELD CCG' AS CCG_NAME,  'R482' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOUTHERN DERBYSH CCG' AS CCG_NAME,  'R022' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOUTHWARK CCG' AS CCG_NAME,  'R037' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS DEVON CCG' AS CCG_NAME,  'R131' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS N LINCOLNSHIRE CCG' AS CCG_NAME,  'R121' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS MERTON CCG' AS CCG_NAME,  'R008' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NEWARK & SHERWD CCG' AS CCG_NAME,  'R014' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SWINDON CCG' AS CCG_NAME,  'R003' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOUTH WORCS CCG' AS CCG_NAME,  'R529' AS CONTRACT_R_CODE UNION ALL
		SELECT 'ARGYLL & BUTE HSCP' AS CCG_NAME,  'R113' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WOLVERHAMPTON CCG' AS CCG_NAME,  'R524' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WYRE FOREST CCG' AS CCG_NAME,  'R529' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NORTH AYRSHIRE HSCP' AS CCG_NAME,  'R159' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NORTH LANARKSHIRE HSCP' AS CCG_NAME,  'R160' AS CONTRACT_R_CODE UNION ALL
		SELECT 'ORKNEY HEALTH & CARE' AS CCG_NAME,  'R118' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOUTH TYNESIDE CCG' AS CCG_NAME,  'R007' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS TOWER HAMLETS CCG' AS CCG_NAME,  'R154' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS RICHMOND CCG' AS CCG_NAME,  'R008' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NE LINCOLNSHIRE CCG' AS CCG_NAME,  'R121' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS CROYDON CCG' AS CCG_NAME,  'R008' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS LINCOLNSHIRE E CCG' AS CCG_NAME,  'R141' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SW LINCOLNSHIRE CCG' AS CCG_NAME,  'R024' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BEXLEY CCG' AS CCG_NAME,  'R521' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOUTH KENT COAST CCG' AS CCG_NAME,  'R032' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS GUILDFRD & WAVER CCG' AS CCG_NAME,  'R040' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS TRAFFORD CCG' AS CCG_NAME,  'R514' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS LEEDS S & E CCG' AS CCG_NAME,  'R138' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SANDWLL W BMNGHM CCG' AS CCG_NAME,  'R532' AS CONTRACT_R_CODE UNION ALL
		SELECT 'MORAY HSCP' AS CCG_NAME,  'R116' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NOTTINGHAM N & E CCG' AS CCG_NAME,  'R014' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HILLINGDON CCG' AS CCG_NAME,  'R165' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS THURROCK CCG' AS CCG_NAME,  'R136' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WEST LANCASHIRE CCG' AS CCG_NAME,  'R146' AS CONTRACT_R_CODE UNION ALL
		SELECT 'RENFREWSHIRE HSCP' AS CCG_NAME,  'R112' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOUTHEND CCG' AS CCG_NAME,  'R136' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS LINCOLNSHIRE W CCG' AS CCG_NAME,  'R141' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS ST HELENS CCG' AS CCG_NAME,  'R147' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HASTINGS & ROTHR CCG' AS CCG_NAME,  'R031' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NORTH MANCHESTER CCG' AS CCG_NAME,  'R171' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BRISTOL CCG' AS CCG_NAME,  'R026' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS STAFFORD & SURR CCG' AS CCG_NAME,  'R140' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS STOKE ON TRENT CCG' AS CCG_NAME,  'R140' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS E RIDING OF YORK CCG' AS CCG_NAME,  'R036' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NORTH SOMERSET CCG' AS CCG_NAME,  'R026' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS EASTERN CHESHIRE CCG' AS CCG_NAME,  'R209' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SLOUGH CCG' AS CCG_NAME,  'R132' AS CONTRACT_R_CODE UNION ALL
		SELECT 'FALKIRK HSCP' AS CCG_NAME,  'R111' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NOTTINGHAM CITY CCG' AS CCG_NAME,  'R014' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SHROPSHIRE CCG' AS CCG_NAME,  'R140' AS CONTRACT_R_CODE UNION ALL
		SELECT 'DUNDEE HSCP' AS CCG_NAME,  'R149' AS CONTRACT_R_CODE UNION ALL
		SELECT 'EAST RENFREWSHIRE HSCP' AS CCG_NAME,  'R112' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS CHILTERN CCG' AS CCG_NAME,  'R152' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS STOCKPORT CCG' AS CCG_NAME,  'R214' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS AYLESBURY VALE CCG' AS CCG_NAME,  'R152' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS DUDLEY CCG' AS CCG_NAME,  'R523' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SUTTON CCG' AS CCG_NAME,  'R008' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOUTHPT & FORMBY CCG' AS CCG_NAME,  'R146' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS EALING CCG' AS CCG_NAME,  'R163' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS DARTF GRVES SWAN CCG' AS CCG_NAME,  'R135' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS VALE OF YORK CCG' AS CCG_NAME,  'R098' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS VALE ROYAL CCG' AS CCG_NAME,  'R209' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BRADFORD DIST CCG' AS CCG_NAME,  'R139' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOUTH READING CCG' AS CCG_NAME,  'R132' AS CONTRACT_R_CODE UNION ALL
		SELECT 'WESTERN ISLES HSCP' AS CCG_NAME,  'R114' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOUTH TEES CCG' AS CCG_NAME,  'R006' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS DURH EASING SEDG CCG' AS CCG_NAME,  'R006' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HULL CCG' AS CCG_NAME,  'R036' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WARWICKSHIRE N CCG' AS CCG_NAME,  'R525' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WEST ESSEX CCG' AS CCG_NAME,  'R034' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WEST HAMPSHIRE CCG' AS CCG_NAME,  'R009' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WEST KENT CCG' AS CCG_NAME,  'R135' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS W LEICESTERSHIRE CCG' AS CCG_NAME,  'R045' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WAKEFIELD CCG' AS CCG_NAME,  'R170' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WALSALL CCG' AS CCG_NAME,  'R531' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WEST LONDON CCG' AS CCG_NAME,  'R169' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WEST NORFOLK CCG' AS CCG_NAME,  'R166' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WILTSHIRE CCG' AS CCG_NAME,  'R003' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WEST SUFFOLK CCG' AS CCG_NAME,  'R151' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS WIGAN BOROUGH CCG' AS CCG_NAME,  'R182' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SUNDERLAND CCG' AS CCG_NAME,  'R007' AS CONTRACT_R_CODE UNION ALL
		SELECT 'SCOTTISH BORDERS HSCP' AS CCG_NAME,  'R115' AS CONTRACT_R_CODE UNION ALL
		SELECT 'SHETLAND HSCP' AS CCG_NAME,  'R119' AS CONTRACT_R_CODE UNION ALL
		SELECT 'SOUTH AYRSHIRE HSCP' AS CCG_NAME,  'R159' AS CONTRACT_R_CODE UNION ALL
		SELECT 'SOUTH LANARKSHIRE HSCP' AS CCG_NAME,  'R160' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS N STAFFORDSHIRE CCG' AS CCG_NAME,  'R140' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS MID ESSEX CCG' AS CCG_NAME,  'R136' AS CONTRACT_R_CODE UNION ALL
		SELECT 'SWANSEA BAY UNI' AS CCG_NAME,  'R130' AS CONTRACT_R_CODE UNION ALL
		-- SELECT 'SWANSEA BAY UNI' AS CCG_NAME,  'R130' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS CAMBRDG & PBORO CCG' AS CCG_NAME,  'R024' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BASSETLAW CCG' AS CCG_NAME,  'R021' AS CONTRACT_R_CODE UNION ALL
		SELECT 'Central Manchester (Paediatrics)' AS CCG_NAME,  'R145' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SE STAFFS & SEIS CCG' AS CCG_NAME,  'R140' AS CONTRACT_R_CODE UNION ALL
		SELECT 'PERTH & KINROSS HSCP' AS CCG_NAME,  'R149' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BARNET CCG' AS CCG_NAME,  'R153' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BANES CCG' AS CCG_NAME,  'R003' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS LEWISHAM CCG' AS CCG_NAME,  'R037' AS CONTRACT_R_CODE UNION ALL
		SELECT 'MIDLOTHIAN HSCP' AS CCG_NAME,  'R117' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NORTH NORFOLK CCG' AS CCG_NAME,  'R166' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS PORTSMOUTH CCG' AS CCG_NAME,  'R133' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SHEFFIELD CCG' AS CCG_NAME,  'R010' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BOLTON CCG' AS CCG_NAME,  'R144' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS AIRED WHARF CRVE CCG' AS CCG_NAME,  'R029' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS ENFIELD CCG' AS CCG_NAME,  'R153' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SURREY HEATH CCG' AS CCG_NAME,  'R027' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS GT YARMTH & WAVE CCG' AS CCG_NAME,  'R166' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS CALDERDALE CCG' AS CCG_NAME,  'R482' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HERTS VALLEYS CCG' AS CCG_NAME,  'R164' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS HARROGT & RURAL CCG' AS CCG_NAME,  'R002' AS CONTRACT_R_CODE UNION ALL
		SELECT 'HIGHLAND HSCP' AS CCG_NAME,  'R113' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NEWCASTLE WEST CCG' AS CCG_NAME,  'R076' AS CONTRACT_R_CODE UNION ALL
		SELECT 'EAST DUNBARTONSHIRE HSCP' AS CCG_NAME,  'R112' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOMERSET CCG' AS CCG_NAME,  'R020' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS SOUTH WARWICKSHR CCG' AS CCG_NAME,  'R525' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS S EASTERN HANTS CCG' AS CCG_NAME,  'R133' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS CENTRAL MANCHSTR CCG' AS CCG_NAME,  'R514' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS EASTB HAILS SEAF CCG' AS CCG_NAME,  'R031' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS BLACKB WTH DARWN CCG' AS CCG_NAME,  'R150' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NORTH TYNESIDE CCG' AS CCG_NAME,  'R076' AS CONTRACT_R_CODE UNION ALL
		SELECT 'POWYS TEACHING' AS CCG_NAME,  'R491' AS CONTRACT_R_CODE UNION ALL
		SELECT 'BRADFD DIST & CRAVEN CCG' AS CCG_NAME,  'R139' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS NORTH CUMBRIA CCG' AS CCG_NAME,  'R076' AS CONTRACT_R_CODE UNION ALL
		SELECT 'HEREFORDSHRE & WORCS CCG' AS CCG_NAME,  'R174' AS CONTRACT_R_CODE UNION ALL
		SELECT 'NHS GATESHEAD CCG' AS CCG_NAME,  'R033' AS CONTRACT_R_CODE
		),
		CTR_ID AS (
		SELECT CONTRACT_R_CODE, D.CONTRACT_ID, ROW_NUMBER() OVER(PARTITION BY CONTRACT_R_CODE ORDER BY D.CONTRACT_ID ASC) AS TES  FROM CCG_MAP
		LEFT JOIN PRD_SNS_UKI.SNS_UKI_DSP_SNU.DIM_MEDICAL_CONTRACT D ON CCG_MAP.CONTRACT_R_CODE = D.GROUP_ID
		),
		CTR_ID2 AS (
		SELECT CONTRACT_R_CODE,CONTRACT_ID FROM CTR_ID WHERE TES = 1)
		
		
		Select  
		'Homeward Sales' as SOURCE,
		S.CONTRACT_ID,
		MD.CONTRACT_R_ID,
		PA.CURO_SUB_CONTRACT_ID,
		S.SALES_CHANNEL_ID,
		S.PRODUCT_ID,
		S.GEOGRAPHY_ID,
		SUM(INVOICE_ACTUAL_QUANTITY_SINGLE)::NUMBER(38,2) as Volumes_in_Units, --Invoice_Units,
		SUM(SUBTOTAL_5_PRICING_COND_GBP)::NUMBER(38,2) + sum(VAT_VALUE_GBP)::NUMBER(38,2) as Invoiced_Sales, --Total_Invoice,
		SUM(INVOICE_ACTUAL_QUANTITY_SINGLE* P.FP10_PRICE)::NUMBER(38,2) as FP10_PRICE,
		P.FP10_PRICE AS FP10_VALUE
		  FROM  SNS_UKI_DSP_SNU.FACT_SALES_INVOICE S
		  LEFT JOIN  SNS_UKI_DSP_SNU.DIM_PRODUCT P ON S.PRODUCT_ID= P.PRODUCT_ID
		  LEFT JOIN SNS_UKI_DSP_SNU.DIM_CURO_PATIENT PA ON PA.PATIENT_ID=S.PATIENT_ID
		  LEFT JOIN PRD_SNS_UKI.SNS_UKI_DSP_SNU.DIM_MEDICAL_CONTRACT MD ON MD.CONTRACT_ID=S.CONTRACT_ID
		  WHERE S.INVOICE_DATE_ID <=(SELECT STARTDATE from MAX_MTH)  and S.INVOICE_DATE_ID  >= (SELECT ENDDATE from MAX_MTH) --last iqvia year
		  -- WHERE SUBSTR(S.INVOICE_DATE_ID,1,6)=SUBSTR((SELECT STARTDATE from MAX_MTH),1,6)  -- last IQVIA month data
		  -- WHERE S.INVOICE_DATE_ID <= 20241031 and S.INVOICE_DATE_ID >= 20231101
		  and S.SALES_CHANNEL_ID in (2)
		  and S.product_id <> 2071
		  and S.ORDER_REASON_CODE not in ('ZMA', 'ZIL', 'ZMK', 'ZIT')
		  group by 
		  SOURCE,
		  S.CONTRACT_ID,
		  MD.CONTRACT_R_ID,
		  PA.CURO_SUB_CONTRACT_ID,
		  S.SALES_CHANNEL_ID,
		  S.PRODUCT_ID,
		  S.GEOGRAPHY_ID,
		  P.FP10_PRICE
		  
		UNION ALL
		select 'Hospital' as Source,
		S.CONTRACT_ID,
		MD.CONTRACT_R_ID,
		PA.CURO_SUB_CONTRACT_ID,
		S.SALES_CHANNEL_ID,
		S.PRODUCT_ID,
		S.GEOGRAPHY_ID,
		SUM(QUANTITY_PIECE)::NUMBER(38,2) as Volumes_in_Units,--as Channel_Sales_Singles,
		SUM(SALES_VALUE_GBP)::NUMBER(38,2) as Invoiced_Sales,-- Channel_Sales_GBP,
		sum(QUANTITY_PIECE* P.FP10_PRICE)::NUMBER(38,2) as FP10_PRICE,
		P.FP10_PRICE AS FP10_VALUE
		FROM  SNS_UKI_DSP_SNU.FACT_CHANNEL_SALES S
		LEFT JOIN  SNS_UKI_DSP_SNU.DIM_PRODUCT P
		ON S.PRODUCT_ID= P.PRODUCT_ID
		LEFT JOIN SNS_UKI_DSP_SNU.DIM_CURO_PATIENT PA ON S.PATIENT_ID=PA.PATIENT_ID
		LEFT JOIN PRD_SNS_UKI.SNS_UKI_DSP_SNU.DIM_MEDICAL_CONTRACT MD ON MD.CONTRACT_ID=S.CONTRACT_ID
		WHERE DATE_ID <=(SELECT STARTDATE from MAX_MTH)  and DATE_ID  >= (SELECT ENDDATE from MAX_MTH) and S.sales_channel_id = 1  -- whole 1 year data
		-- WHERE SUBSTR(DATE_ID,1,6)=SUBSTR((SELECT STARTDATE from MAX_MTH),1,6) and S.sales_channel_id = 1  -- last IQVIA month data
		-- WHERE DATE_ID <= 20241031 and DATE_ID >= 20231101 AND S.sales_channel_id = 1
		group by 
		SOURCE,
		S.CONTRACT_ID,
		MD.CONTRACT_R_ID,
		PA.CURO_SUB_CONTRACT_ID,
		S.SALES_CHANNEL_ID,
		S.PRODUCT_ID,
		S.GEOGRAPHY_ID,
		P.FP10_PRICE
		
		UNION ALL
		
		SELECT
		   'Community' as SOURCE,
		    CTR_ID2.CONTRACT_ID,
		    MD.CONTRACT_R_ID,
		    PA.CURO_SUB_CONTRACT_ID,
		    A.SALES_CHANNEL_ID,
		    A.PRODUCT_ID,
		    A.GEOGRAPHY_ID,
		    SUM(QUANTITY_PIECE)::NUMBER(38,2) as Volumes_in_Units,-- Community_Singles,
		    SUM(SALES_VALUE_GBP)::NUMBER(38,2) as Invoiced_Sales, --Community_Value_in_GBP
		    0 AS FP10_PRICE,
		    B.FP10_PRICE AS FP10_VALUE
		FROM
		     SNS_UKI_DSP_SNU.FACT_CHANNEL_SALES_MONTHLY A
		LEFT JOIN SNS_UKI_DSP_SNU.DIM_CURO_PATIENT PA ON A.PATIENT_ID=PA.PATIENT_ID
		LEFT JOIN SNS_UKI_DSP_SNU.DIM_GEO_TERRITORY GEO ON A.GEOGRAPHY_ID = GEO.GEO_TERRITORY_ID
		LEFT JOIN SNS_UKI_DSP_SNU.DIM_GEO_CCG   CCG ON GEO.GEO_CCG_ID = CCG.GEO_CCG_ID
		LEFT JOIN CCG_MAP CCG_MAP ON CCG.CCG_NAME = CCG_MAP.CCG_NAME
		LEFT JOIN CTR_ID2 ON CTR_ID2.CONTRACT_R_CODE = CCG_MAP.CONTRACT_R_CODE
		join SNS_UKI_DSP_SNU.DIM_PRODUCT B ON A.PRODUCT_ID = B.PRODUCT_ID
		LEFT JOIN PRD_SNS_UKI.SNS_UKI_DSP_SNU.DIM_MEDICAL_CONTRACT MD ON MD.CONTRACT_ID=CTR_ID2.CONTRACT_ID
		join SNS_UKI_DSP_SNU.DIM_PRODUCT_HIER_LOCAL_6 C ON B.PROD_HIER_LOCAL_6_ID = C.PROD_HIER_LOCAL_6_ID
		join SNS_UKI_DSP_SNU.DIM_PRODUCT_HIER_LOCAL_5 D ON C.PROD_HIER_LOCAL_5_ID = D.PROD_HIER_LOCAL_5_ID
		join SNS_UKI_DSP_SNU.DIM_PRODUCT_HIER_LOCAL_4 E ON D.PROD_HIER_LOCAL_4_ID = E.PROD_HIER_LOCAL_4_ID
		join SNS_UKI_DSP_SNU.DIM_PRODUCT_HIER_LOCAL_3 F ON E.PROD_HIER_LOCAL_3_ID = F.PROD_HIER_LOCAL_3_ID AND F.PROD_HIER_LOCAL_3_ID <> 5675
		join SNS_UKI_DSP_SNU.DIM_PRODUCT_HIER_LOCAL_2 G ON F.PROD_HIER_LOCAL_2_ID = G.PROD_HIER_LOCAL_2_ID AND F.PROD_HIER_LOCAL_2_ID IN (745,6,11,746)
		WHERE to_char(MONTH_ID * 100 + 1) >= (SELECT ENDDATE FROM MAX_MTH) AND to_char(MONTH_ID * 100 + 1) <= (SELECT STARTDATE FROM MAX_MTH)  --last iqvia year
		  -- WHERE MONTH_ID=SUBSTR((SELECT STARTDATE from MAX_MTH),1,6)  -- last IQVIA month data
		AND SALES_CHANNEL_ID =3
		group by 
		SOURCE,
		CTR_ID2.CONTRACT_ID,
		MD.CONTRACT_R_ID,
		PA.CURO_SUB_CONTRACT_ID,
		SALES_CHANNEL_ID,
		A.PRODUCT_ID,
		A.GEOGRAPHY_ID,
		B.FP10_PRICE
		) FT LEFT JOIN SNS_UKI_DSP_SNU.DIM_PRODUCT PRD ON FT.PRODUCT_ID = PRD.PRODUCT_ID
		    ", null, [EnableFolding=true]),
		    #"Renamed Columns" = Table.RenameColumns(Source,{{"PRODUCT_CODE", "SKU"}})
		in
		    #"Renamed Columns" */
		  
		  let x="" in x
		```
	lineageTag: d75862ec-3fc0-4d6f-8527-bab8c6f34a7c
	queryGroup: Archive

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Text

expression 'Cogs_Community_Original (og)' =
		/*let
		    Source = Value.NativeQuery(Snowflake.Databases("danone.west-europe.azure.snowflakecomputing.com","PRD_UKI_ANL_WH",[Implementation="2.0", Role="PRD_UKI_USER"]){[Name="PRD_UKI"]}[Data], "With MAX_MTH AS#(lf)(#(lf)SELECT#(lf)TO_NUMBER(TO_VARCHAR(LAST_DAY(TO_DATE(MAX('202503')|| '01','YYYYMMDD')),'YYYYMMDD')) AS STARTDATE,#(lf)TO_NUMBER(TO_VARCHAR(ADD_MONTHS(TO_DATE(MAX('202503')|| '01','YYYYMMDD'),-11),'YYYYMMDD')) AS ENDDATE,#(lf)LAST_DAY(TO_DATE(MAX('202503')|| '01','YYYYMMDD'))::TIMESTAMP_TZ AS MONTHEND_TZ,#(lf)DATEADD(DAY,-1,LAST_DAY(TO_DATE(MAX('202503')|| '01','YYYYMMDD')))::TIMESTAMP_TZ AS MONTHEND_TZ1,#(lf)TO_DATE(MAX('202503')|| '01','YYYYMMDD')::TIMESTAMP_TZ AS MONTHSTART_TZ#(lf)#(lf)-- SELECT #(lf)-- TO_NUMBER(TO_VARCHAR(LAST_DAY(TO_DATE(MAX(MONTH_ID)|| '01','YYYYMMDD')),'YYYYMMDD')) AS STARTDATE,#(lf)-- TO_NUMBER(TO_VARCHAR(ADD_MONTHS(TO_DATE(MAX(MONTH_ID)|| '01','YYYYMMDD'),-11),'YYYYMMDD')) AS ENDDATE,#(lf)-- LAST_DAY(TO_DATE(MAX(MONTH_ID)|| '01','YYYYMMDD'))::TIMESTAMP_TZ AS MONTHEND_TZ,#(lf)-- DATEADD(DAY,-1,LAST_DAY(TO_DATE(MAX(MONTH_ID)|| '01','YYYYMMDD')))::TIMESTAMP_TZ AS MONTHEND_TZ1,#(lf)-- TO_DATE(MAX(MONTH_ID)|| '01','YYYYMMDD')::TIMESTAMP_TZ AS MONTHSTART_TZ#(lf)-- FROM UKI_DSP_SNU.FACT_IQVIA_RSA#(lf))#(lf),CTE AS#(lf)(#(lf)SELECT #(lf)FT.COMPANY_CODE,#(lf)FT.PRODUCT_ID,#(lf)FT.MATERIAL_NUMBER AS SKU,#(lf)FT.MATERIAL_DESCRIPTION,#(lf)FT.MONTH_ID,#(lf)NVL(CON.CONVERSION_MULTIPLIER,1) AS CONVERSION_MULTIPLIER,#(lf)SUM(FT.INVOICED_QTY_UNIT) AS INVOICED_QTY_UNIT, #(lf)SUM(FT.TOTAL_STD_COGS) AS TOTAL_STD_COGS#(lf)FROM (#(lf)    SELECT  #(lf)    D.COMPANY_CODE,#(lf)    A.PRODUCT_ID,#(lf)    H.MATERIAL_NUMBER,#(lf)    H.MATERIAL_DESCRIPTION,#(lf)    A.MONTH_ID,#(lf)    B.INDICATOR_NAME,#(lf)    -- SUM(A.MONTHLY_VALUE) VALUE,#(lf)    CASE WHEN UPPER(B.INDICATOR_NAME)='INV_QTY_UNITS' THEN SUM(A.MONTHLY_VALUE)#(lf)    ELSE 0 END AS INVOICED_QTY_UNIT,#(lf)    CASE WHEN UPPER(B.INDICATOR_NAME)='TOT_STD_COGS' THEN SUM(A.MONTHLY_VALUE)#(lf)    ELSE 0 END AS TOTAL_STD_COGS#(lf)    FROM PRD_UKI.UKI_DSP_CBS.FACT_FINANCIAL_KPI A#(lf)    JOIN PRD_UKI.UKI_DSP_CBS.DIM_INDICATOR B ON (A.INDICATOR_ID=B.INDICATOR_ID)#(lf)    JOIN PRD_UKI.UKI_DSP_CBS.DIM_COMPANY D ON (A.COMPANY_ID=D.COMPANY_ID)#(lf)    JOIN PRD_UKI.UKI_DSP_CBS.DIM_MARKET E ON (A.MARKET_ID=E.MARKET_ID)#(lf)    JOIN PRD_UKI.UKI_DSP_CBS.DIM_PHASE F ON (A.PHASE_ID=F.PHASE_ID)#(lf)    JOIN PRD_UKI.UKI_DSP_CBS.DIM_CUSTOMER G ON (A.CUSTOMER_ID=G.CUSTOMER_ID)#(lf)    JOIN PRD_UKI.UKI_DSP_CBS.DIM_PRODUCT H ON (A.PRODUCT_ID=H.PRODUCT_ID)#(lf)    LEFT OUTER JOIN PRD_UKI.UKI_STG_CBS.STG_MDS_LF_FINANCE_INDICATOR_GROUP I#(lf)    ON (B.COMPANY_CODE= I.COMPANY_CODE AND B.INDICATOR_NAME=UPPER(I.INDICATOR_NAME))#(lf)    WHERE D.COMPANY_CODE IN ('4810')#(lf)    AND  A.MONTH_ID= (SELECT SUBSTR(STARTDATE,1,6) FROM MAX_MTH)#(lf)    AND UPPER(MARKET_NAME) IN ('DOMESTIC')#(lf)    AND UPPER(PHASE_GROUP_NAME) LIKE '%ACT%'#(lf)    AND UPPER(B.INDICATOR_NAME)  IN ('INV_QTY_UNITS','TOT_STD_COGS')#(lf)    GROUP BY #(lf)    D.COMPANY_CODE,#(lf)    H.MATERIAL_NUMBER,#(lf)    H.MATERIAL_DESCRIPTION,#(lf)    A.PRODUCT_ID,#(lf)    A.MONTH_ID,#(lf)    B.INDICATOR_NAME#(lf)) FT #(lf)LEFT JOIN PRD_UKI.UKI_DTM_SNU.LKUP_PRODUCT_CLUSTERPACK_CONV CON ON FT.MATERIAL_NUMBER=CON.PRODUCT_CODE#(lf)WHERE FT.MATERIAL_NUMBER in (select distinct product_code from PRD_UKI.UKI_DSP_SNU.dim_product #(lf)-- where --product_code = 'ELEMENTAL _10862' and prod_hier_local_6_id = '1127043' and sales_organisation = '4810'#(lf)-- where prod_hier_local_6_id = '1125695' and sales_organisation = '4810'#(lf))#(lf)GROUP BY FT.COMPANY_CODE,FT.MATERIAL_NUMBER,FT.MONTH_ID,FT.PRODUCT_ID,CON.CONVERSION_MULTIPLIER,FT.MATERIAL_DESCRIPTION#(lf))#(lf)#(lf)SELECT #(lf)CTE.COMPANY_CODE,#(lf)SNU_PRD.PROD_HIER_LOCAL_6_ID AS SNU_PROD_HIER_LOCAL_6_ID,#(lf)CTE.MONTH_ID,#(lf)MAX(CTE.CONVERSION_MULTIPLIER) AS CONVERSION_MULTIPLIER,#(lf)SUM(CTE.INVOICED_QTY_UNIT) AS INVOICED_QTY_UNIT, #(lf)SUM(CTE.TOTAL_STD_COGS) AS TOTAL_STD_COGS,#(lf)CASE #(lf)    WHEN SUM(CTE.INVOICED_QTY_UNIT)<>0 THEN SUM(TOTAL_STD_COGS) / SUM(INVOICED_QTY_UNIT)* NVL(MAX(CTE.CONVERSION_MULTIPLIER),1)#(lf)    ELSE 0 #(lf)END AS TOTAL_STD_COGS_PER_UNIT#(lf)FROM CTE#(lf)JOIN (SELECT *,ROW_NUMBER() OVER (PARTITION BY PRODUCT_CODE ORDER BY PRODUCT_ID DESC) AS RN FROM PRD_UKI.UKI_DTM_SNU.DIM_PRODUCT QUALIFY RN=1) SNU_PRD ON CTE.SKU=SNU_PRD.PRODUCT_CODE#(lf)GROUP BY#(lf)CTE.COMPANY_CODE,#(lf)SNU_PRD.PROD_HIER_LOCAL_6_ID,#(lf)CTE.MONTH_ID", null, [EnableFolding=true]),
		    #"Changed Type" = Table.TransformColumnTypes(Source,{{"MONTH_ID", type text}})
		in
		    #"Changed Type"*/
		
		    let x="" in x
	lineageTag: 52389142-359f-4073-8464-e5495757b40e
	queryGroup: Archive

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Text

expression Cogs_Community_ =
		/*
		let
		    Source = Table.NestedJoin(Cogs_Community_Original, {"SNU_PROD_HIER_LOCAL_6_ID"}, DIM_PRODUCT, {"PROD_HIER_LOCAL_6_ID"}, "DIM_PRODUCT", JoinKind.LeftOuter),
		    #"Expanded DIM_PRODUCT" = Table.ExpandTableColumn(Source, "DIM_PRODUCT", {"PRODUCT_ID", "SKU", "Product", "PROD_HIER_LOCAL_6_ID", "PROD_MANUFACTURER_ID"}, {"DIM_PRODUCT.PRODUCT_ID", "DIM_PRODUCT.SKU", "DIM_PRODUCT.Product", "DIM_PRODUCT.PROD_HIER_LOCAL_6_ID", "DIM_PRODUCT.PROD_MANUFACTURER_ID"})
		in
		    #"Expanded DIM_PRODUCT"
		*/
		let x = "" in x
	lineageTag: 3136f114-1274-4312-835d-9c87f32fcfd9
	queryGroup: Archive

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Text

expression DB =
		/*let
		    Source = Snowflake.Databases("danone.west-europe.azure.snowflakecomputing.com","PRD_UKI_ANL_WH",[Implementation="2.0", Role="PRD_UKI_USER"]),
		    PRD_UKI_Database = Source{[Name="PRD_UKI",Kind="Database"]}[Data]
		in
		    PRD_UKI_Database*/
		    let x="" in x
	lineageTag: 9e4ea2f8-e88d-4241-97d7-c5460bcf15e7
	queryGroup: Archive

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Text

expression Cogs_Community_Original_with_month = ```
		/*let
		    Source = Value.NativeQuery(Snowflake.Databases("danone.west-europe.azure.snowflakecomputing.com","PRD_UKI_ANL_WH",[Implementation="2.0", Role="PRD_UKI_USER"]){[Name="PRD_UKI"]}[Data], 
		    
		    "
		With MAX_MTH AS
		(
		SELECT 
		TO_NUMBER(TO_VARCHAR(LAST_DAY(TO_DATE(MAX('202503')|| '01','YYYYMMDD')),'YYYYMMDD')) AS STARTDATE,
		TO_NUMBER(TO_VARCHAR(ADD_MONTHS(TO_DATE(MAX('202503')|| '01','YYYYMMDD'),-11),'YYYYMMDD')) AS ENDDATE,
		LAST_DAY(TO_DATE(MAX('202503')|| '01','YYYYMMDD'))::TIMESTAMP_TZ AS MONTHEND_TZ,
		DATEADD(DAY,-1,LAST_DAY(TO_DATE(MAX('202503')|| '01','YYYYMMDD')))::TIMESTAMP_TZ AS MONTHEND_TZ1,
		TO_DATE(MAX('202503')|| '01','YYYYMMDD')::TIMESTAMP_TZ AS MONTHSTART_TZ
		)
		,CTE AS
		(
		SELECT 
		FT.COMPANY_CODE,
		FT.PRODUCT_ID,
		FT.MATERIAL_NUMBER AS SKU,
		FT.MATERIAL_DESCRIPTION,
		FT.MONTH_ID,
		NVL(CON.CONVERSION_MULTIPLIER,1) AS CONVERSION_MULTIPLIER,
		SUM(FT.INVOICED_QTY_UNIT) AS INVOICED_QTY_UNIT, 
		SUM(FT.TOTAL_STD_COGS) AS TOTAL_STD_COGS,
		SUM(FT.INV_QTY_CAS) AS INV_QTY_CAS,
		SUM(FT.INV_SAL) AS INV_SAL,
		SUM(FT.NET_NET_SAL) AS NET_NET_SAL
		FROM (
		    SELECT  
		    D.COMPANY_CODE,
		    A.PRODUCT_ID,
		    H.MATERIAL_NUMBER,
		    H.MATERIAL_DESCRIPTION,
		    A.MONTH_ID,
		    B.INDICATOR_NAME,
		    -- SUM(A.MONTHLY_VALUE) VALUE,
		    CASE WHEN UPPER(B.INDICATOR_NAME)='INV_QTY_UNITS' THEN SUM(A.MONTHLY_VALUE)
		    ELSE 0 END AS INVOICED_QTY_UNIT,
		    CASE WHEN UPPER(B.INDICATOR_NAME)='TOT_STD_COGS' THEN SUM(A.MONTHLY_VALUE)
		    ELSE 0 END AS TOTAL_STD_COGS,
		    CASE WHEN UPPER(B.INDICATOR_NAME)='INV_QTY_CAS' THEN SUM(A.MONTHLY_VALUE)
		    ELSE 0 END AS INV_QTY_CAS,
		    CASE WHEN UPPER(B.INDICATOR_NAME)='INV_SAL' THEN SUM(A.MONTHLY_VALUE)
		    ELSE 0 END AS INV_SAL,
		    CASE WHEN UPPER(B.INDICATOR_NAME)='NET_NET_SAL' THEN SUM(A.MONTHLY_VALUE)
		    ELSE 0 END AS NET_NET_SAL
		    FROM PRD_UKI.UKI_DSP_CBS.FACT_FINANCIAL_KPI A
		    JOIN PRD_UKI.UKI_DSP_CBS.DIM_INDICATOR B ON (A.INDICATOR_ID=B.INDICATOR_ID)
		    JOIN PRD_UKI.UKI_DSP_CBS.DIM_COMPANY D ON (A.COMPANY_ID=D.COMPANY_ID)
		    JOIN PRD_UKI.UKI_DSP_CBS.DIM_MARKET E ON (A.MARKET_ID=E.MARKET_ID)
		    JOIN PRD_UKI.UKI_DSP_CBS.DIM_PHASE F ON (A.PHASE_ID=F.PHASE_ID)
		    JOIN PRD_UKI.UKI_DSP_CBS.DIM_CUSTOMER G ON (A.CUSTOMER_ID=G.CUSTOMER_ID)
		    JOIN PRD_UKI.UKI_DSP_CBS.DIM_PRODUCT H ON (A.PRODUCT_ID=H.PRODUCT_ID)
		    LEFT OUTER JOIN PRD_UKI.UKI_STG_CBS.STG_MDS_LF_FINANCE_INDICATOR_GROUP I
		    ON (B.COMPANY_CODE= I.COMPANY_CODE AND B.INDICATOR_NAME=UPPER(I.INDICATOR_NAME))
		    WHERE D.COMPANY_CODE IN ('4810')
		    AND to_char(MONTH_ID * 100 + 1) >= (SELECT ENDDATE FROM MAX_MTH) AND to_char(MONTH_ID * 100 + 1) <= (SELECT STARTDATE FROM MAX_MTH) 
		    -- A.MONTH_ID= (SELECT SUBSTR(STARTDATE,1,6) FROM MAX_MTH)
		    AND UPPER(MARKET_NAME) IN ('DOMESTIC')
		    AND UPPER(PHASE_GROUP_NAME) LIKE '%ACT%'
		    AND UPPER(B.INDICATOR_NAME)  IN ('INV_QTY_UNITS','TOT_STD_COGS','INV_QTY_CAS','INV_SAL','NET_NET_SAL')
		    GROUP BY 
		    D.COMPANY_CODE,
		    H.MATERIAL_NUMBER,
		    H.MATERIAL_DESCRIPTION,
		    A.PRODUCT_ID,
		    A.MONTH_ID,
		    B.INDICATOR_NAME
		) FT 
		LEFT JOIN PRD_UKI.UKI_DTM_SNU.LKUP_PRODUCT_CLUSTERPACK_CONV CON ON FT.MATERIAL_NUMBER=CON.PRODUCT_CODE
		WHERE FT.MATERIAL_NUMBER in (select distinct product_code from PRD_UKI.UKI_DSP_SNU.dim_product 
		-- where --product_code = 'ELEMENTAL _10862' and prod_hier_local_6_id = '1127043' and sales_organisation = '4810'
		-- where prod_hier_local_6_id = '1125695' and sales_organisation = '4810'
		)
		GROUP BY FT.COMPANY_CODE,FT.MATERIAL_NUMBER,FT.MONTH_ID,FT.PRODUCT_ID,CON.CONVERSION_MULTIPLIER,FT.MATERIAL_DESCRIPTION
		)
		-- SELECT * FROM CTE
		
		,COM_COGS AS(
		SELECT 
		CTE.COMPANY_CODE,
		SNU_PRD.PROD_HIER_LOCAL_6_ID AS SNU_PROD_HIER_LOCAL_6_ID,
		CTE.MONTH_ID,
		MAX(CTE.CONVERSION_MULTIPLIER) AS CONVERSION_MULTIPLIER,
		SUM(CTE.INVOICED_QTY_UNIT) AS INVOICED_QTY_UNIT,
		SUM(CTE.INVOICED_QTY_UNIT * CTE.TOTAL_STD_COGS) AS INVOICED_QTY_UNIT_COGS,
		SUM(CTE.TOTAL_STD_COGS) AS TOTAL_STD_COGS,
		SUM(CTE.INV_QTY_CAS) AS INV_QTY_CAS,
		SUM(CTE.INV_SAL) AS INV_SAL,
		SUM(CTE.NET_NET_SAL) AS NET_NET_SAL
		FROM CTE
		JOIN (SELECT *,ROW_NUMBER() OVER (PARTITION BY PRODUCT_CODE ORDER BY PRODUCT_ID DESC) AS RN FROM PRD_UKI.UKI_DTM_SNU.DIM_PRODUCT QUALIFY RN=1) SNU_PRD ON CTE.SKU=SNU_PRD.PRODUCT_CODE
		GROUP BY
		CTE.COMPANY_CODE,
		SNU_PRD.PROD_HIER_LOCAL_6_ID,
		CTE.MONTH_ID
		)
		SELECT COMPANY_CODE,SNU_PROD_HIER_LOCAL_6_ID,MONTH_ID,CONVERSION_MULTIPLIER,INVOICED_QTY_UNIT,TOTAL_STD_COGS,INV_QTY_CAS,INV_SAL,NET_NET_SAL, 
		CASE 
		    WHEN INVOICED_QTY_UNIT <> 0 THEN TOTAL_STD_COGS * 1000/INVOICED_QTY_UNIT 
		    ELSE 0 
		END AS WEIGHTED_COGS_PER_UNIT
		FROM COM_COGS
		    
		    "
		    , null, [EnableFolding=true])
		in
		Source */
		let x="" in x
		```
	lineageTag: b78178c0-91f2-4522-88bd-672712508ad3
	queryGroup: Archive

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Text

expression Color_Codes =
		/*let
		    Source = Table.FromRows(Json.Document(Binary.Decompress(Binary.FromText("i44FAA==", BinaryEncoding.Base64), Compression.Deflate)), let _t = ((type nullable text) meta [Serialized.Text = true]) in type table [Column1 = _t]),
		    #"Changed Type" = Table.TransformColumnTypes(Source,{{"Column1", type text}}),
		    #"Removed Columns" = Table.RemoveColumns(#"Changed Type",{"Column1"})
		in
		    #"Removed Columns"*/
		    let x="" in x
	lineageTag: f1fdbf3d-471b-48df-baca-d14f0d05d803
	queryGroup: Archive

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Text

expression 'Community_Product_Grouping (2)' =
		/*let
		    Source = Table.FromRows(Json.Document(Binary.Decompress(Binary.FromText("rZhbb9s2FID/CpHnJvAlXrpHWqItzpTIklQSo+hDthhtgWIO4hTF/v1IUZIlWSSPsj0lML9z5eHhoT5/vtpwqWkiSU5QwnPBiCZovlhtrz5cJcfXA+KFuvryoeYUFRWFE402dC0rNGdRVkiukdJYaiKR+WUHlDM2pojlJdPU+bWYzWD6DTu0gDySf5RJSHG13NMVdmICutglmAFjgmV2QlbXXGsWy2gNiXWEk7jYgrOUE2jQtsAILSaUo6XfUZGNyG8QIfKoJY5E4JgJtbDn21JaR/bRTfHFezsl4qEwKHLBcKHRGiuSRnzcyJJqlBKliIlqvpr5O091vJszi+95KfcR5Y3vMCq+CUm5php79BWlljSVtNgFj4wgot75gsjtHmXCYwszviUdW08/jl8Pf/fWVoG1xcq/NihML6EyrhW69WIe4fkspnmwRosNNskraFtW4unwfELXKCN0M0AatwPIKo64beByDdAX1jSPG+tW1hhZlaJVdTO7cOf0/aXHxNbNXY7zfX2ujG/bEFuf8c7FOdyAocjIHetDVc65zmgctGF3D3eUh/sYQ0evgCGcYEVNQ0O/z5DgDymRyp4um1j+9u3wej6ydoDCtpFQeW0aym0IyinbqQzvSHtSPcraLAYxRj+V9Nxs+5AkBWW8QHc3qzbIIaEENUnxLAtJrrnwaHcjJO5ku7+e40czHDGkSmEyrTgr17Y5rnaXyfGgs5E8Nij75HHLo+tmzK7gbG9HrGAW7T1BN1iihZuPIebmy4Xfmism019HwlMJLlLqCiSnj+jjiElz41BG1XlwN9Vspqt5uw/pP6eXb09fvz+F8EUz74/TrpE4dNlc0ONoHY85WGg5i3MKJxmxA6ufTBgx+Z7fBfxro3GPGEbuzdS4DMfUyrjruiMTSJtLhGNvw4lwbi9jgE1UOLYKq/MUVdfk82Ys9KZPNDXn3GfHX+iv4+kNvRx/PR9eT6OoUxdEa9OrOzAZ19mvEoCAOywQHyqw1/oDUtVcp0z3rKe6ZrjAzz9/vCH9889DH8vt0FzpBIBAnSnF9s95ZGxHLJ8EyAN364FUzWO6GH8wXS+lZR7XmPAiIYWZA7V5H0TT1JkMoFvQEYHFWGd2EtwZMwYDv09Q8T2OOl9BwEArFua0MrVOjcoHbIs+ine2E6Z/boI/N9buCDZ5t2IC3c2awk73JCpRfdkSrFTIvnvMeMWFWQGcqfrNWYlCjFQPVPMca15jXrZ918A6QItnBNRW+jww+51qALacbnqm0d3Kiwni9B6bTpQ2/RUuYL8ETJOopkf7C3xL3tuNYKXrkYuJ+c95tAPZZjWlMVwIwKsT2D87uba1k9Ft1l6y9v+msv4vPfEuOntvdmtz0ItDm+cFlink3qjJmMqP/9HzYSGGLlPzcrcX1KXk8MvPhVgUqHV6OW0Hl6CmlpjgXiszJZYp7Ht8iaWi0X2u/ikuD7/y+FyOcmfzUIcvkxE1Ml5uUTEvsKOFed3YD6L1818JklBsXnMabbbuE0DvS0JacvvNwEtnRGDJfeq+/As=", BinaryEncoding.Base64), Compression.Deflate)), let _t = ((type nullable text) meta [Serialized.Text = true]) in type table [#"Commercial 6" = _t, Classification = _t]),
		    #"AllReplace" = [#"Core ONS" = """Core ONS""", #"Calogen" = """Calogen""", #"Paeds - HEIF" = """Paeds - HEIF""", #"Paeds - sip" = """Paeds - sip""",#"Adult Tube" = """Adult Tube""", #"Paeds - Tube" = """Paeds - Tube""",#"Dysphagia" = """Dysphagia""",  #"Other ONS" = """Other ONS""", #"Low cost powders" = """Low cost powders"""],
		    #"Replaced Value" = Table.TransformColumns(Source,{{"Classification",each Record.FieldOrDefault(AllReplace,_,_)}}),
		    #"Changed Type" = Table.TransformColumnTypes(#"Replaced Value",{{"Classification", type text}})
		
		
		
		in
		    #"Changed Type"*/
		    let x= "" in x
	lineageTag: 70e9477d-6eb6-4977-8019-ede61696dae5
	queryGroup: Archive

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Text

expression Cogs_Community_Original-->0728 = ```
		/*let
		    Source = Value.NativeQuery(Snowflake.Databases("danone.west-europe.azure.snowflakecomputing.com","PRD_UKI_ANL_WH",[Implementation="2.0", Role="PRD_UKI_USER"]){[Name="PRD_UKI"]}[Data], 
		    
		    "
		    With MAX_MTH AS
		(
		SELECT 
		TO_NUMBER(TO_VARCHAR(LAST_DAY(TO_DATE(MAX('202503')|| '01','YYYYMMDD')),'YYYYMMDD')) AS STARTDATE,
		TO_NUMBER(TO_VARCHAR(ADD_MONTHS(TO_DATE(MAX('202503')|| '01','YYYYMMDD'),-11),'YYYYMMDD')) AS ENDDATE,
		LAST_DAY(TO_DATE(MAX('202503')|| '01','YYYYMMDD'))::TIMESTAMP_TZ AS MONTHEND_TZ,
		DATEADD(DAY,-1,LAST_DAY(TO_DATE(MAX('202503')|| '01','YYYYMMDD')))::TIMESTAMP_TZ AS MONTHEND_TZ1,
		TO_DATE(MAX('202503')|| '01','YYYYMMDD')::TIMESTAMP_TZ AS MONTHSTART_TZ
		)
		,CTE AS
		(
		SELECT 
		FT.COMPANY_CODE,
		FT.PRODUCT_ID,
		FT.MATERIAL_NUMBER AS SKU,
		FT.MATERIAL_DESCRIPTION,
		FT.MONTH_ID,
		NVL(CON.CONVERSION_MULTIPLIER,1) AS CONVERSION_MULTIPLIER,
		SUM(FT.INVOICED_QTY_UNIT) AS INVOICED_QTY_UNIT, 
		SUM(FT.TOTAL_STD_COGS) AS TOTAL_STD_COGS,
		SUM(FT.INV_QTY_CAS) AS INV_QTY_CAS,
		SUM(FT.INV_SAL) AS INV_SAL,
		SUM(FT.NET_NET_SAL) AS NET_NET_SAL
		FROM (
		    SELECT  
		    D.COMPANY_CODE,
		    A.PRODUCT_ID,
		    H.MATERIAL_NUMBER,
		    H.MATERIAL_DESCRIPTION,
		    A.MONTH_ID,
		    B.INDICATOR_NAME,
		    -- SUM(A.MONTHLY_VALUE) VALUE,
		    CASE WHEN UPPER(B.INDICATOR_NAME)='INV_QTY_UNITS' THEN SUM(A.MONTHLY_VALUE)
		    ELSE 0 END AS INVOICED_QTY_UNIT,
		    CASE WHEN UPPER(B.INDICATOR_NAME)='TOT_STD_COGS' THEN SUM(A.MONTHLY_VALUE)
		    ELSE 0 END AS TOTAL_STD_COGS,
		    CASE WHEN UPPER(B.INDICATOR_NAME)='INV_QTY_CAS' THEN SUM(A.MONTHLY_VALUE)
		    ELSE 0 END AS INV_QTY_CAS,
		    CASE WHEN UPPER(B.INDICATOR_NAME)='INV_SAL' THEN SUM(A.MONTHLY_VALUE)
		    ELSE 0 END AS INV_SAL,
		    CASE WHEN UPPER(B.INDICATOR_NAME)='NET_NET_SAL' THEN SUM(A.MONTHLY_VALUE)
		    ELSE 0 END AS NET_NET_SAL
		    FROM PRD_UKI.UKI_DSP_CBS.FACT_FINANCIAL_KPI A
		    JOIN PRD_UKI.UKI_DSP_CBS.DIM_INDICATOR B ON (A.INDICATOR_ID=B.INDICATOR_ID)
		    JOIN PRD_UKI.UKI_DSP_CBS.DIM_COMPANY D ON (A.COMPANY_ID=D.COMPANY_ID)
		    JOIN PRD_UKI.UKI_DSP_CBS.DIM_MARKET E ON (A.MARKET_ID=E.MARKET_ID)
		    JOIN PRD_UKI.UKI_DSP_CBS.DIM_PHASE F ON (A.PHASE_ID=F.PHASE_ID)
		    JOIN PRD_UKI.UKI_DSP_CBS.DIM_CUSTOMER G ON (A.CUSTOMER_ID=G.CUSTOMER_ID)
		    JOIN PRD_UKI.UKI_DSP_CBS.DIM_PRODUCT H ON (A.PRODUCT_ID=H.PRODUCT_ID)
		    LEFT OUTER JOIN PRD_UKI.UKI_STG_CBS.STG_MDS_LF_FINANCE_INDICATOR_GROUP I
		    ON (B.COMPANY_CODE= I.COMPANY_CODE AND B.INDICATOR_NAME=UPPER(I.INDICATOR_NAME))
		    WHERE D.COMPANY_CODE IN ('4810')
		    AND to_char(MONTH_ID * 100 + 1) >= (SELECT ENDDATE FROM MAX_MTH) AND to_char(MONTH_ID * 100 + 1) <= (SELECT STARTDATE FROM MAX_MTH) 
		    -- A.MONTH_ID= (SELECT SUBSTR(STARTDATE,1,6) FROM MAX_MTH)
		    AND UPPER(MARKET_NAME) IN ('DOMESTIC')
		    AND UPPER(PHASE_GROUP_NAME) LIKE '%ACT%'
		    AND UPPER(B.INDICATOR_NAME)  IN ('INV_QTY_UNITS','TOT_STD_COGS','INV_QTY_CAS','INV_SAL','NET_NET_SAL')
		    GROUP BY 
		    D.COMPANY_CODE,
		    H.MATERIAL_NUMBER,
		    H.MATERIAL_DESCRIPTION,
		    A.PRODUCT_ID,
		    A.MONTH_ID,
		    B.INDICATOR_NAME
		) FT 
		LEFT JOIN PRD_UKI.UKI_DTM_SNU.LKUP_PRODUCT_CLUSTERPACK_CONV CON ON FT.MATERIAL_NUMBER=CON.PRODUCT_CODE
		WHERE FT.MATERIAL_NUMBER in (select distinct product_code from PRD_UKI.UKI_DSP_SNU.dim_product 
		-- where --product_code = 'ELEMENTAL _10862' and prod_hier_local_6_id = '1127043' and sales_organisation = '4810'
		-- where prod_hier_local_6_id = '1125695' and sales_organisation = '4810'
		)
		GROUP BY FT.COMPANY_CODE,FT.MATERIAL_NUMBER,FT.MONTH_ID,FT.PRODUCT_ID,CON.CONVERSION_MULTIPLIER,FT.MATERIAL_DESCRIPTION
		)
		-- SELECT * FROM CTE
		
		,COM_COGS AS(
		SELECT 
		CTE.COMPANY_CODE,
		SNU_PRD.PROD_HIER_LOCAL_6_ID AS SNU_PROD_HIER_LOCAL_6_ID,
		-- CTE.MONTH_ID,
		MAX(CTE.CONVERSION_MULTIPLIER) AS CONVERSION_MULTIPLIER,
		SUM(CTE.INVOICED_QTY_UNIT) AS INVOICED_QTY_UNIT,
		SUM(CTE.INVOICED_QTY_UNIT * CTE.TOTAL_STD_COGS) AS INVOICED_QTY_UNIT_COGS,
		SUM(CTE.TOTAL_STD_COGS) AS TOTAL_STD_COGS,
		SUM(CTE.INV_QTY_CAS) AS INV_QTY_CAS,
		SUM(CTE.INV_SAL) AS INV_SAL,
		SUM(CTE.NET_NET_SAL) AS NET_NET_SAL
		FROM CTE
		JOIN (SELECT *,ROW_NUMBER() OVER (PARTITION BY PRODUCT_CODE ORDER BY PRODUCT_ID DESC) AS RN FROM PRD_UKI.UKI_DTM_SNU.DIM_PRODUCT QUALIFY RN=1) SNU_PRD ON CTE.SKU=SNU_PRD.PRODUCT_CODE
		GROUP BY
		CTE.COMPANY_CODE,
		SNU_PRD.PROD_HIER_LOCAL_6_ID
		-- CTE.MONTH_ID
		)
		SELECT COMPANY_CODE,SNU_PROD_HIER_LOCAL_6_ID,CONVERSION_MULTIPLIER,INVOICED_QTY_UNIT,TOTAL_STD_COGS,INV_QTY_CAS,INV_SAL,NET_NET_SAL, 
		CASE 
		    WHEN INVOICED_QTY_UNIT <> 0 THEN TOTAL_STD_COGS * 1000/INVOICED_QTY_UNIT 
		    ELSE 0 
		END AS WEIGHTED_COGS_PER_UNIT
		FROM COM_COGS
		    
		    ", null, [EnableFolding=true]),
		    #"Filtered Rows" = Table.SelectRows(Source, each ([SNU_PROD_HIER_LOCAL_6_ID] = 1124593))
		in
		    #"Filtered Rows" */
		
		    let x = "" in x
		```
	lineageTag: 412a598b-a781-4660-a1f8-6a42dd59ad3e
	queryGroup: Archive

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Exception

